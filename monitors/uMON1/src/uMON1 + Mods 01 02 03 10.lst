0001   0000             ; ######################################
0002   0000             ; #                                    #
0003   0000             ; #         uMON1 Version 1.04         #
0004   0000             ; #  --------------------------------  #
0005   0000             ; #   Special Key Sequences            #
0006   0000             ; #  --------------------------------  #
0007   0000             ; #   Shift-+ - Insert byte.           #
0008   0000             ; #   Shift-- - Delete byte.           #
0009   0000             ; #                                    #
0010   0000             ; #  --------------------------------  #
0011   0000             ; #   Included Modules                 #
0012   0000             ; #  --------------------------------  #
0013   0000             ; #   MOD01-RAMTest         (Shift-0)  #
0014   0000             ; #   MOD02-Serial Send     (Shift-1)  #
0015   0000             ; #   MOD03-Serial Receive  (Shift-2)  #
0016   0000             ; #   MOD10-Serial Loopback (Shift-F)  #
0017   0000             ; #  --------------------------------  #
0018   0000             ; #                                    #
0019   0000             ; #  by Scott Gregory                  #
0020   0000             ; #  13/06/2021                        #
0021   0000             ; #                                    #
0022   0000             ; #  Last update                       #
0023   0000             ; #  18/07/2021                        #
0024   0000             ; ######################################
0025   0000             ;
0026   0000             STACKTOP	.EQU	$08C0 ; Stack position.
0027   0000             ROMBASE		.EQU	$0000 ; Start of ROM.
0028   0000             ROMTOP		.EQU	$07FF ; End of ROM.
0029   0000             RAMBASE		.EQU	$0900 ; Start of user RAM.
0030   0000             RAMTOP		.EQU	$FFFF ; End of user RAM.
0031   0000             CATHDLY		.EQU	$40 ; Digit display delay.
0032   0000             KEYPORT		.EQU	$00 ; Keypad port.
0033   0000             CATHPORT	.EQU	$01 ; Display catchode port.
0034   0000             SEGPORT		.EQU	$02 ; Display segment port.
0035   0000             ;
0036   0000             ADDRESS		.EQU	$08C1 ; 2 Bytes.
0037   0000             SCRATCH		.EQU	$08C3 ; 2 Bytes.
0038   0000             MODE		.EQU	$08C5 ; 1 Byte.
0039   0000             KEYDATA		.EQU	$08C6 ; 1 Byte.
0040   0000             BEEPLENGTH	.EQU	$08C7 ; 2 Bytes.
0041   0000             BEEPFREQ	.EQU	$08C9 ; 1 Byte.
0042   0000             ;
0043   0000             ; Begin global MOD assignments.
0044   0000             SERBUFFER	.EQU	$06
0045   0000             SERSTATUS	.EQU	$07
0046   0000             SERSTART	.EQU	$08F6
0047   0000             SEREND		.EQU	$08F8
0048   0000             ; End global MOD assignments.
0049   0000             ;
0050   0000             ; Begin MOD-01 assignments.
0051   0000             M01START	.EQU	$08F0
0052   0000             M01FINISH	.EQU	$08F2
0053   0000             M01PATTERN	.EQU	$08F4
0054   0000             ; End MOD-01 assignments.
0055   0000             ;
0056   0000             ; Begin MOD-02 assignments.
0057   0000             ; End MOD-02 assignments.
0058   0000             ;
0059   0000             ; Begin MOD-10 assignments.
0060   0000             ; End MOD-10 assignments.
0061   0000             ;
0062   0000 00 00 00 00 			.FILL	(ROMTOP - ROMBASE) + 1, $00
0062   0004 00 00 00 00 
0062   0008 00 00 00 00 
0062   000C 00 00 00 00 
0062   0010 00 00 00 00 
0062   0014 00 00 00 00 
0062   0018 00 00 00 00 
0062   001C 00 00 00 00 
0062   0020 00 00 00 00 
0062   0024 00 00 00 00 
0062   0028 00 00 00 00 
0062   002C 00 00 00 00 
0062   0030 00 00 00 00 
0062   0034 00 00 00 00 
0062   0038 00 00 00 00 
0062   003C 00 00 00 00 
0062   0040 00 00 00 00 
0062   0044 00 00 00 00 
0062   0048 00 00 00 00 
0062   004C 00 00 00 00 
0062   0050 00 00 00 00 
0062   0054 00 00 00 00 
0062   0058 00 00 00 00 
0062   005C 00 00 00 00 
0062   0060 00 00 00 00 
0062   0064 00 00 00 00 
0062   0068 00 00 00 00 
0062   006C 00 00 00 00 
0062   0070 00 00 00 00 
0062   0074 00 00 00 00 
0062   0078 00 00 00 00 
0062   007C 00 00 00 00 
0062   0080 00 00 00 00 
0062   0084 00 00 00 00 
0062   0088 00 00 00 00 
0062   008C 00 00 00 00 
0062   0090 00 00 00 00 
0062   0094 00 00 00 00 
0062   0098 00 00 00 00 
0062   009C 00 00 00 00 
0062   00A0 00 00 00 00 
0062   00A4 00 00 00 00 
0062   00A8 00 00 00 00 
0062   00AC 00 00 00 00 
0062   00B0 00 00 00 00 
0062   00B4 00 00 00 00 
0062   00B8 00 00 00 00 
0062   00BC 00 00 00 00 
0062   00C0 00 00 00 00 
0062   00C4 00 00 00 00 
0062   00C8 00 00 00 00 
0062   00CC 00 00 00 00 
0062   00D0 00 00 00 00 
0062   00D4 00 00 00 00 
0062   00D8 00 00 00 00 
0062   00DC 00 00 00 00 
0062   00E0 00 00 00 00 
0062   00E4 00 00 00 00 
0062   00E8 00 00 00 00 
0062   00EC 00 00 00 00 
0062   00F0 00 00 00 00 
0062   00F4 00 00 00 00 
0062   00F8 00 00 00 00 
0062   00FC 00 00 00 00 
0062   0100 00 00 00 00 
0062   0104 00 00 00 00 
0062   0108 00 00 00 00 
0062   010C 00 00 00 00 
0062   0110 00 00 00 00 
0062   0114 00 00 00 00 
0062   0118 00 00 00 00 
0062   011C 00 00 00 00 
0062   0120 00 00 00 00 
0062   0124 00 00 00 00 
0062   0128 00 00 00 00 
0062   012C 00 00 00 00 
0062   0130 00 00 00 00 
0062   0134 00 00 00 00 
0062   0138 00 00 00 00 
0062   013C 00 00 00 00 
0062   0140 00 00 00 00 
0062   0144 00 00 00 00 
0062   0148 00 00 00 00 
0062   014C 00 00 00 00 
0062   0150 00 00 00 00 
0062   0154 00 00 00 00 
0062   0158 00 00 00 00 
0062   015C 00 00 00 00 
0062   0160 00 00 00 00 
0062   0164 00 00 00 00 
0062   0168 00 00 00 00 
0062   016C 00 00 00 00 
0062   0170 00 00 00 00 
0062   0174 00 00 00 00 
0062   0178 00 00 00 00 
0062   017C 00 00 00 00 
0062   0180 00 00 00 00 
0062   0184 00 00 00 00 
0062   0188 00 00 00 00 
0062   018C 00 00 00 00 
0062   0190 00 00 00 00 
0062   0194 00 00 00 00 
0062   0198 00 00 00 00 
0062   019C 00 00 00 00 
0062   01A0 00 00 00 00 
0062   01A4 00 00 00 00 
0062   01A8 00 00 00 00 
0062   01AC 00 00 00 00 
0062   01B0 00 00 00 00 
0062   01B4 00 00 00 00 
0062   01B8 00 00 00 00 
0062   01BC 00 00 00 00 
0062   01C0 00 00 00 00 
0062   01C4 00 00 00 00 
0062   01C8 00 00 00 00 
0062   01CC 00 00 00 00 
0062   01D0 00 00 00 00 
0062   01D4 00 00 00 00 
0062   01D8 00 00 00 00 
0062   01DC 00 00 00 00 
0062   01E0 00 00 00 00 
0062   01E4 00 00 00 00 
0062   01E8 00 00 00 00 
0062   01EC 00 00 00 00 
0062   01F0 00 00 00 00 
0062   01F4 00 00 00 00 
0062   01F8 00 00 00 00 
0062   01FC 00 00 00 00 
0062   0200 00 00 00 00 
0062   0204 00 00 00 00 
0062   0208 00 00 00 00 
0062   020C 00 00 00 00 
0062   0210 00 00 00 00 
0062   0214 00 00 00 00 
0062   0218 00 00 00 00 
0062   021C 00 00 00 00 
0062   0220 00 00 00 00 
0062   0224 00 00 00 00 
0062   0228 00 00 00 00 
0062   022C 00 00 00 00 
0062   0230 00 00 00 00 
0062   0234 00 00 00 00 
0062   0238 00 00 00 00 
0062   023C 00 00 00 00 
0062   0240 00 00 00 00 
0062   0244 00 00 00 00 
0062   0248 00 00 00 00 
0062   024C 00 00 00 00 
0062   0250 00 00 00 00 
0062   0254 00 00 00 00 
0062   0258 00 00 00 00 
0062   025C 00 00 00 00 
0062   0260 00 00 00 00 
0062   0264 00 00 00 00 
0062   0268 00 00 00 00 
0062   026C 00 00 00 00 
0062   0270 00 00 00 00 
0062   0274 00 00 00 00 
0062   0278 00 00 00 00 
0062   027C 00 00 00 00 
0062   0280 00 00 00 00 
0062   0284 00 00 00 00 
0062   0288 00 00 00 00 
0062   028C 00 00 00 00 
0062   0290 00 00 00 00 
0062   0294 00 00 00 00 
0062   0298 00 00 00 00 
0062   029C 00 00 00 00 
0062   02A0 00 00 00 00 
0062   02A4 00 00 00 00 
0062   02A8 00 00 00 00 
0062   02AC 00 00 00 00 
0062   02B0 00 00 00 00 
0062   02B4 00 00 00 00 
0062   02B8 00 00 00 00 
0062   02BC 00 00 00 00 
0062   02C0 00 00 00 00 
0062   02C4 00 00 00 00 
0062   02C8 00 00 00 00 
0062   02CC 00 00 00 00 
0062   02D0 00 00 00 00 
0062   02D4 00 00 00 00 
0062   02D8 00 00 00 00 
0062   02DC 00 00 00 00 
0062   02E0 00 00 00 00 
0062   02E4 00 00 00 00 
0062   02E8 00 00 00 00 
0062   02EC 00 00 00 00 
0062   02F0 00 00 00 00 
0062   02F4 00 00 00 00 
0062   02F8 00 00 00 00 
0062   02FC 00 00 00 00 
0062   0300 00 00 00 00 
0062   0304 00 00 00 00 
0062   0308 00 00 00 00 
0062   030C 00 00 00 00 
0062   0310 00 00 00 00 
0062   0314 00 00 00 00 
0062   0318 00 00 00 00 
0062   031C 00 00 00 00 
0062   0320 00 00 00 00 
0062   0324 00 00 00 00 
0062   0328 00 00 00 00 
0062   032C 00 00 00 00 
0062   0330 00 00 00 00 
0062   0334 00 00 00 00 
0062   0338 00 00 00 00 
0062   033C 00 00 00 00 
0062   0340 00 00 00 00 
0062   0344 00 00 00 00 
0062   0348 00 00 00 00 
0062   034C 00 00 00 00 
0062   0350 00 00 00 00 
0062   0354 00 00 00 00 
0062   0358 00 00 00 00 
0062   035C 00 00 00 00 
0062   0360 00 00 00 00 
0062   0364 00 00 00 00 
0062   0368 00 00 00 00 
0062   036C 00 00 00 00 
0062   0370 00 00 00 00 
0062   0374 00 00 00 00 
0062   0378 00 00 00 00 
0062   037C 00 00 00 00 
0062   0380 00 00 00 00 
0062   0384 00 00 00 00 
0062   0388 00 00 00 00 
0062   038C 00 00 00 00 
0062   0390 00 00 00 00 
0062   0394 00 00 00 00 
0062   0398 00 00 00 00 
0062   039C 00 00 00 00 
0062   03A0 00 00 00 00 
0062   03A4 00 00 00 00 
0062   03A8 00 00 00 00 
0062   03AC 00 00 00 00 
0062   03B0 00 00 00 00 
0062   03B4 00 00 00 00 
0062   03B8 00 00 00 00 
0062   03BC 00 00 00 00 
0062   03C0 00 00 00 00 
0062   03C4 00 00 00 00 
0062   03C8 00 00 00 00 
0062   03CC 00 00 00 00 
0062   03D0 00 00 00 00 
0062   03D4 00 00 00 00 
0062   03D8 00 00 00 00 
0062   03DC 00 00 00 00 
0062   03E0 00 00 00 00 
0062   03E4 00 00 00 00 
0062   03E8 00 00 00 00 
0062   03EC 00 00 00 00 
0062   03F0 00 00 00 00 
0062   03F4 00 00 00 00 
0062   03F8 00 00 00 00 
0062   03FC 00 00 00 00 
0062   0400 00 00 00 00 
0062   0404 00 00 00 00 
0062   0408 00 00 00 00 
0062   040C 00 00 00 00 
0062   0410 00 00 00 00 
0062   0414 00 00 00 00 
0062   0418 00 00 00 00 
0062   041C 00 00 00 00 
0062   0420 00 00 00 00 
0062   0424 00 00 00 00 
0062   0428 00 00 00 00 
0062   042C 00 00 00 00 
0062   0430 00 00 00 00 
0062   0434 00 00 00 00 
0062   0438 00 00 00 00 
0062   043C 00 00 00 00 
0062   0440 00 00 00 00 
0062   0444 00 00 00 00 
0062   0448 00 00 00 00 
0062   044C 00 00 00 00 
0062   0450 00 00 00 00 
0062   0454 00 00 00 00 
0062   0458 00 00 00 00 
0062   045C 00 00 00 00 
0062   0460 00 00 00 00 
0062   0464 00 00 00 00 
0062   0468 00 00 00 00 
0062   046C 00 00 00 00 
0062   0470 00 00 00 00 
0062   0474 00 00 00 00 
0062   0478 00 00 00 00 
0062   047C 00 00 00 00 
0062   0480 00 00 00 00 
0062   0484 00 00 00 00 
0062   0488 00 00 00 00 
0062   048C 00 00 00 00 
0062   0490 00 00 00 00 
0062   0494 00 00 00 00 
0062   0498 00 00 00 00 
0062   049C 00 00 00 00 
0062   04A0 00 00 00 00 
0062   04A4 00 00 00 00 
0062   04A8 00 00 00 00 
0062   04AC 00 00 00 00 
0062   04B0 00 00 00 00 
0062   04B4 00 00 00 00 
0062   04B8 00 00 00 00 
0062   04BC 00 00 00 00 
0062   04C0 00 00 00 00 
0062   04C4 00 00 00 00 
0062   04C8 00 00 00 00 
0062   04CC 00 00 00 00 
0062   04D0 00 00 00 00 
0062   04D4 00 00 00 00 
0062   04D8 00 00 00 00 
0062   04DC 00 00 00 00 
0062   04E0 00 00 00 00 
0062   04E4 00 00 00 00 
0062   04E8 00 00 00 00 
0062   04EC 00 00 00 00 
0062   04F0 00 00 00 00 
0062   04F4 00 00 00 00 
0062   04F8 00 00 00 00 
0062   04FC 00 00 00 00 
0062   0500 00 00 00 00 
0062   0504 00 00 00 00 
0062   0508 00 00 00 00 
0062   050C 00 00 00 00 
0062   0510 00 00 00 00 
0062   0514 00 00 00 00 
0062   0518 00 00 00 00 
0062   051C 00 00 00 00 
0062   0520 00 00 00 00 
0062   0524 00 00 00 00 
0062   0528 00 00 00 00 
0062   052C 00 00 00 00 
0062   0530 00 00 00 00 
0062   0534 00 00 00 00 
0062   0538 00 00 00 00 
0062   053C 00 00 00 00 
0062   0540 00 00 00 00 
0062   0544 00 00 00 00 
0062   0548 00 00 00 00 
0062   054C 00 00 00 00 
0062   0550 00 00 00 00 
0062   0554 00 00 00 00 
0062   0558 00 00 00 00 
0062   055C 00 00 00 00 
0062   0560 00 00 00 00 
0062   0564 00 00 00 00 
0062   0568 00 00 00 00 
0062   056C 00 00 00 00 
0062   0570 00 00 00 00 
0062   0574 00 00 00 00 
0062   0578 00 00 00 00 
0062   057C 00 00 00 00 
0062   0580 00 00 00 00 
0062   0584 00 00 00 00 
0062   0588 00 00 00 00 
0062   058C 00 00 00 00 
0062   0590 00 00 00 00 
0062   0594 00 00 00 00 
0062   0598 00 00 00 00 
0062   059C 00 00 00 00 
0062   05A0 00 00 00 00 
0062   05A4 00 00 00 00 
0062   05A8 00 00 00 00 
0062   05AC 00 00 00 00 
0062   05B0 00 00 00 00 
0062   05B4 00 00 00 00 
0062   05B8 00 00 00 00 
0062   05BC 00 00 00 00 
0062   05C0 00 00 00 00 
0062   05C4 00 00 00 00 
0062   05C8 00 00 00 00 
0062   05CC 00 00 00 00 
0062   05D0 00 00 00 00 
0062   05D4 00 00 00 00 
0062   05D8 00 00 00 00 
0062   05DC 00 00 00 00 
0062   05E0 00 00 00 00 
0062   05E4 00 00 00 00 
0062   05E8 00 00 00 00 
0062   05EC 00 00 00 00 
0062   05F0 00 00 00 00 
0062   05F4 00 00 00 00 
0062   05F8 00 00 00 00 
0062   05FC 00 00 00 00 
0062   0600 00 00 00 00 
0062   0604 00 00 00 00 
0062   0608 00 00 00 00 
0062   060C 00 00 00 00 
0062   0610 00 00 00 00 
0062   0614 00 00 00 00 
0062   0618 00 00 00 00 
0062   061C 00 00 00 00 
0062   0620 00 00 00 00 
0062   0624 00 00 00 00 
0062   0628 00 00 00 00 
0062   062C 00 00 00 00 
0062   0630 00 00 00 00 
0062   0634 00 00 00 00 
0062   0638 00 00 00 00 
0062   063C 00 00 00 00 
0062   0640 00 00 00 00 
0062   0644 00 00 00 00 
0062   0648 00 00 00 00 
0062   064C 00 00 00 00 
0062   0650 00 00 00 00 
0062   0654 00 00 00 00 
0062   0658 00 00 00 00 
0062   065C 00 00 00 00 
0062   0660 00 00 00 00 
0062   0664 00 00 00 00 
0062   0668 00 00 00 00 
0062   066C 00 00 00 00 
0062   0670 00 00 00 00 
0062   0674 00 00 00 00 
0062   0678 00 00 00 00 
0062   067C 00 00 00 00 
0062   0680 00 00 00 00 
0062   0684 00 00 00 00 
0062   0688 00 00 00 00 
0062   068C 00 00 00 00 
0062   0690 00 00 00 00 
0062   0694 00 00 00 00 
0062   0698 00 00 00 00 
0062   069C 00 00 00 00 
0062   06A0 00 00 00 00 
0062   06A4 00 00 00 00 
0062   06A8 00 00 00 00 
0062   06AC 00 00 00 00 
0062   06B0 00 00 00 00 
0062   06B4 00 00 00 00 
0062   06B8 00 00 00 00 
0062   06BC 00 00 00 00 
0062   06C0 00 00 00 00 
0062   06C4 00 00 00 00 
0062   06C8 00 00 00 00 
0062   06CC 00 00 00 00 
0062   06D0 00 00 00 00 
0062   06D4 00 00 00 00 
0062   06D8 00 00 00 00 
0062   06DC 00 00 00 00 
0062   06E0 00 00 00 00 
0062   06E4 00 00 00 00 
0062   06E8 00 00 00 00 
0062   06EC 00 00 00 00 
0062   06F0 00 00 00 00 
0062   06F4 00 00 00 00 
0062   06F8 00 00 00 00 
0062   06FC 00 00 00 00 
0062   0700 00 00 00 00 
0062   0704 00 00 00 00 
0062   0708 00 00 00 00 
0062   070C 00 00 00 00 
0062   0710 00 00 00 00 
0062   0714 00 00 00 00 
0062   0718 00 00 00 00 
0062   071C 00 00 00 00 
0062   0720 00 00 00 00 
0062   0724 00 00 00 00 
0062   0728 00 00 00 00 
0062   072C 00 00 00 00 
0062   0730 00 00 00 00 
0062   0734 00 00 00 00 
0062   0738 00 00 00 00 
0062   073C 00 00 00 00 
0062   0740 00 00 00 00 
0062   0744 00 00 00 00 
0062   0748 00 00 00 00 
0062   074C 00 00 00 00 
0062   0750 00 00 00 00 
0062   0754 00 00 00 00 
0062   0758 00 00 00 00 
0062   075C 00 00 00 00 
0062   0760 00 00 00 00 
0062   0764 00 00 00 00 
0062   0768 00 00 00 00 
0062   076C 00 00 00 00 
0062   0770 00 00 00 00 
0062   0774 00 00 00 00 
0062   0778 00 00 00 00 
0062   077C 00 00 00 00 
0062   0780 00 00 00 00 
0062   0784 00 00 00 00 
0062   0788 00 00 00 00 
0062   078C 00 00 00 00 
0062   0790 00 00 00 00 
0062   0794 00 00 00 00 
0062   0798 00 00 00 00 
0062   079C 00 00 00 00 
0062   07A0 00 00 00 00 
0062   07A4 00 00 00 00 
0062   07A8 00 00 00 00 
0062   07AC 00 00 00 00 
0062   07B0 00 00 00 00 
0062   07B4 00 00 00 00 
0062   07B8 00 00 00 00 
0062   07BC 00 00 00 00 
0062   07C0 00 00 00 00 
0062   07C4 00 00 00 00 
0062   07C8 00 00 00 00 
0062   07CC 00 00 00 00 
0062   07D0 00 00 00 00 
0062   07D4 00 00 00 00 
0062   07D8 00 00 00 00 
0062   07DC 00 00 00 00 
0062   07E0 00 00 00 00 
0062   07E4 00 00 00 00 
0062   07E8 00 00 00 00 
0062   07EC 00 00 00 00 
0062   07F0 00 00 00 00 
0062   07F4 00 00 00 00 
0062   07F8 00 00 00 00 
0062   07FC 00 00 00 00 
0063   0000             			.ORG	$0000
0064   0000 C3 F2 03    RESET_00:	JP		SETUP
0065   0003             ;
0066   0008             			.ORG	$0008
0067   0008 C3 F2 03    RESET_08:	JP		SETUP
0068   000B             ;
0069   0010             			.ORG	$0010
0070   0010 C3 F2 03    RESET_10:	JP		SETUP
0071   0013             ;
0072   0018             			.ORG	$0018
0073   0018 C3 F2 03    RESET_18:	JP		SETUP
0074   001B             ;
0075   0020             			.ORG	$0020
0076   0020 C3 F2 03    RESET_20:	JP		SETUP
0077   0023             ;
0078   0028             			.ORG	$0028
0079   0028 C3 F2 03    RESET_28:	JP		SETUP
0080   002B             ;
0081   0030             			.ORG	$0030
0082   0030 C3 F2 03    RESET_30:	JP		SETUP
0083   0033             ;
0084   0038             			.ORG	$0038
0085   0038 C3 F2 03    RESET_38:	JP		SETUP
0086   003B             ;
0087   0040             			.ORG	$0040
0088   0040 75 4D 4F 4E VERSION:	.TEXT	"uMON V1.04 by Scott Gregory"
0088   0044 20 56 31 2E 
0088   0048 30 34 20 62 
0088   004C 79 20 53 63 
0088   0050 6F 74 74 20 
0088   0054 47 72 65 67 
0088   0058 6F 72 79 
0089   005B             ;
0090   0066             			.ORG	$0066
0091   0066 F5          NMISERVICE:	PUSH	af ; Keyboard service routine.
0092   0067 DB 00       			IN		a,(KEYPORT)
0093   0069 32 C6 08    			LD		(KEYDATA),a
0094   006C F1          			POP		af
0095   006D ED 45       			RETN
0096   006F             ;
0097   0080             			.ORG	$0080
0098   0080 AF          DISPLAY:	XOR		a ; Display update routine.
0099   0081 D3 01       			OUT		(CATHPORT),a
0100   0083 D3 02       			OUT		(SEGPORT),a
0101   0085 4F          			LD		c,a
0102   0086 CB E9       			SET		5,c
0103   0088 ED 5B C1 08 			LD		de,(ADDRESS)
0104   008C 7A          			LD		a,d
0105   008D 32 C3 08    			LD		(SCRATCH),a
0106   0090 AF          			XOR		a
0107   0091 21 C3 08    			LD		hl,SCRATCH
0108   0094 ED 6F       			RLD
0109   0096 DD 21 10 04 			LD		ix,HEX2SEG
0110   009A 16 00       			LD		d,$00
0111   009C 5F          			LD		e,a
0112   009D DD 19       			ADD		ix,de
0113   009F DD 7E 00    			LD		a,(ix)
0114   00A2 E5          			PUSH	hl
0115   00A3 21 C5 08    			LD		hl,MODE
0116   00A6 CB 46       			BIT		0,(hl)
0117   00A8 CA AD 00    			JP		z,DISL00
0118   00AB F6 10       			OR		$10
0119   00AD E1          DISL00:		POP		hl
0120   00AE D3 02       			OUT		(SEGPORT),a
0121   00B0 79          			LD		a,c
0122   00B1 D3 01       			OUT		(CATHPORT),a
0123   00B3 06 40       			LD		b,CATHDLY
0124   00B5 10 FE       DISL01:		DJNZ	DISL01
0125   00B7 AF          			XOR		a
0126   00B8 D3 01       			OUT		(CATHPORT),a
0127   00BA CB 19       			RR		c
0128   00BC ED 6F       			RLD
0129   00BE DD 21 10 04 			LD		ix,HEX2SEG
0130   00C2 16 00       			LD		d,$00
0131   00C4 5F          			LD		e,a
0132   00C5 DD 19       			ADD		ix,de
0133   00C7 DD 7E 00    			LD		a,(ix)
0134   00CA E5          			PUSH	hl
0135   00CB 21 C5 08    			LD		hl,MODE
0136   00CE CB 46       			BIT		0,(hl)
0137   00D0 CA D5 00    			JP		z,DISL02
0138   00D3 F6 10       			OR		$10
0139   00D5 E1          DISL02:		POP		hl
0140   00D6 D3 02       			OUT		(SEGPORT),a
0141   00D8 79          			LD		a,c
0142   00D9 D3 01       			OUT		(CATHPORT),a
0143   00DB 06 40       			LD		b,CATHDLY
0144   00DD 10 FE       DISL03:		DJNZ	DISL03
0145   00DF AF          			XOR		a
0146   00E0 D3 01       			OUT		(CATHPORT),a
0147   00E2 CB 19       			RR		c
0148   00E4 ED 5B C1 08 			LD		de,(ADDRESS)
0149   00E8 7B          			LD		a,e
0150   00E9 32 C3 08    			LD		(SCRATCH),a
0151   00EC AF          			XOR		a
0152   00ED 21 C3 08    			LD		hl,SCRATCH
0153   00F0 ED 6F       			RLD
0154   00F2 DD 21 10 04 			LD		ix,HEX2SEG
0155   00F6 16 00       			LD		d,$00
0156   00F8 5F          			LD		e,a
0157   00F9 DD 19       			ADD		ix,de
0158   00FB DD 7E 00    			LD		a,(ix)
0159   00FE E5          			PUSH	hl
0160   00FF 21 C5 08    			LD		hl,MODE
0161   0102 CB 46       			BIT		0,(hl)
0162   0104 CA 09 01    			JP		z,DISL04
0163   0107 F6 10       			OR		$10
0164   0109 E1          DISL04:		POP		hl
0165   010A D3 02       			OUT		(SEGPORT),a
0166   010C 79          			LD		a,c
0167   010D D3 01       			OUT		(CATHPORT),a
0168   010F 06 40       			LD			b,CATHDLY
0169   0111 10 FE       DISL05:		DJNZ	DISL05
0170   0113 AF          			XOR		a
0171   0114 D3 01       			OUT		(CATHPORT),a
0172   0116 CB 19       			RR		c
0173   0118 ED 6F       			RLD
0174   011A DD 21 10 04 			LD		ix,HEX2SEG
0175   011E 16 00       			LD		d,$00
0176   0120 5F          			LD		e,a
0177   0121 DD 19       			ADD		ix,de
0178   0123 DD 7E 00    			LD		a,(ix)
0179   0126 E5          			PUSH	hl
0180   0127 21 C5 08    			LD		hl,MODE
0181   012A CB 46       			BIT		0,(hl)
0182   012C CA 31 01    			JP		z,DISL06
0183   012F F6 10       			OR		$10
0184   0131 E1          DISL06:		POP		hl
0185   0132 D3 02       			OUT		(SEGPORT),a
0186   0134 79          			LD		a,c
0187   0135 D3 01       			OUT		(CATHPORT),a
0188   0137 06 40       			LD		b,CATHDLY
0189   0139 10 FE       DISL07:		DJNZ	DISL07
0190   013B AF          			XOR		a
0191   013C D3 01       			OUT		(CATHPORT),a
0192   013E CB 19       			RR		c
0193   0140 2A C1 08    			LD		hl,(ADDRESS)
0194   0143 7E          			LD		a,(hl)
0195   0144 32 C3 08    			LD		(SCRATCH),a
0196   0147 AF          			XOR		a
0197   0148 21 C3 08    			LD		hl,SCRATCH
0198   014B ED 6F       			RLD
0199   014D DD 21 10 04 			LD		ix,HEX2SEG
0200   0151 16 00       			LD		d,$00
0201   0153 5F          			LD		e,a
0202   0154 DD 19       			ADD		ix,de
0203   0156 DD 7E 00    			LD		a,(ix)
0204   0159 E5          			PUSH	hl
0205   015A 21 C5 08    			LD		hl,MODE
0206   015D CB 46       			BIT		0,(hl)
0207   015F C2 64 01    			JP		nz,DISL08
0208   0162 F6 10       			OR		$10
0209   0164 E1          DISL08:		POP		hl
0210   0165 D3 02       			OUT		(SEGPORT),a
0211   0167 79          			LD		a,c
0212   0168 D3 01       			OUT		(CATHPORT),a
0213   016A 06 40       			LD		b,CATHDLY
0214   016C 10 FE       DISL09:		DJNZ	DISL09
0215   016E AF          			XOR		a
0216   016F D3 01       			OUT		(CATHPORT),a
0217   0171 CB 19       			RR		c
0218   0173 ED 6F       			RLD
0219   0175 DD 21 10 04 			LD		ix,HEX2SEG
0220   0179 16 00       			LD		d,$00
0221   017B 5F          			LD		e,a
0222   017C DD 19       			ADD		ix,de
0223   017E DD 7E 00    			LD		a,(ix)
0224   0181 E5          			PUSH	hl
0225   0182 21 C5 08    			LD		hl,MODE
0226   0185 CB 46       			BIT		0,(hl)
0227   0187 C2 8C 01    			JP		nz,DISL0A
0228   018A F6 10       			OR		$10
0229   018C E1          DISL0A:		POP		hl
0230   018D D3 02       			OUT		(SEGPORT),a
0231   018F 79          			LD		a,c
0232   0190 D3 01       			OUT		(CATHPORT),a
0233   0192 06 40       			LD		b,CATHDLY
0234   0194 10 FE       DISL0B:		DJNZ	DISL0B
0235   0196 C9          			RET
0236   0197             ;
0237   0197 E5          KEYBOARD:	PUSH	hl ; Key decoder routine.
0238   0198 F5          			PUSH	af
0239   0199 21 30 00    			LD		hl,$0030
0240   019C 22 C7 08    			LD		(BEEPLENGTH),hl
0241   019F 21 C9 08    			LD		hl,BEEPFREQ
0242   01A2 36 30       			LD		(hl),$30
0243   01A4 21 C6 08    			LD		hl,KEYDATA
0244   01A7 3E FF       			LD		a,$FF
0245   01A9 BE          			CP		(hl)
0246   01AA CA AB 03    			JP		z,KEYLXX
0247   01AD CD B3 03    			CALL	BEEP
0248   01B0 7E          			LD		a,(hl)
0249   01B1 E6 3F       			AND		$3f ; We only want the first 6 bits.
0250   01B3 EE 20       			XOR		$20 ; Flip bit 6 (Shift key) because it gives a 1 when not being pressed.
0251   01B5             ;
0252   01B5 FE 10       			CP		$10 ; + key.
0253   01B7 C2 CD 01    			JP		nz,KEYL00
0254   01BA 2A C1 08    			LD		hl,(ADDRESS)
0255   01BD 23          			INC		hl
0256   01BE 22 C1 08    			LD		(ADDRESS),hl
0257   01C1 21 C5 08    			LD		hl,MODE
0258   01C4 CB 86       			RES		0,(hl)
0259   01C6 CB 8E       			RES		1,(hl)
0260   01C8 CB 96       			RES		2,(hl)
0261   01CA C3 AB 03    			JP		KEYLXX
0262   01CD             ;
0263   01CD FE 11       KEYL00:		CP		$11 ; - key.
0264   01CF C2 E5 01    			JP		nz,KEYL01
0265   01D2 2A C1 08    			LD		hl,(ADDRESS)
0266   01D5 2B          			DEC		hl
0267   01D6 22 C1 08    			LD		(ADDRESS),hl
0268   01D9 21 C5 08    			LD		hl,MODE
0269   01DC CB 86       			RES		0,(hl)
0270   01DE CB 8E       			RES		1,(hl)
0271   01E0 CB 96       			RES		2,(hl)
0272   01E2 C3 AB 03    			JP		KEYLXX
0273   01E5             ;
0274   01E5 FE 12       KEYL01:		CP		$12 ; GO key.
0275   01E7 C2 F1 01    			JP		nz,KEYL02
0276   01EA 31 C0 08    			LD		sp,STACKTOP
0277   01ED 2A C1 08    			LD		hl,(ADDRESS)
0278   01F0 E9          			JP		(hl)
0279   01F1             ;
0280   01F1 FE 13       KEYL02:		CP		$13 ; AD key.
0281   01F3 C2 07 02    			JP		nz,KEYL03
0282   01F6 47          			LD		b,a
0283   01F7 3A C5 08    			LD		a,(MODE)
0284   01FA EE 01       			XOR		$01
0285   01FC CB 8F       			RES		1,a
0286   01FE CB 97       			RES		2,a
0287   0200 32 C5 08    			LD		(MODE),a
0288   0203 78          			LD		a,b
0289   0204 C3 AB 03    			JP		KEYLXX
0290   0207             ;
0291   0207 FE 20       KEYL03:		CP		$20 ; Shift-0 key - MOD-01: RAMTest
0292   0209 C2 16 02    			JP		nz,KEYL04
0293   020C F5          			PUSH	af
0294   020D E5          			PUSH	hl
0295   020E CD 20 04    			CALL	MOD01
0296   0211 E1          			POP		hl
0297   0212 F1          			POP		af
0298   0213 C3 AB 03    			JP		KEYLXX
0299   0216             ;
0300   0216 FE 21       KEYL04:		CP		$21 ; Shift-1 key - MOD-02: Serial Send
0301   0218 C2 25 02    			JP		nz,KEYL05
0302   021B F5          			PUSH	af
0303   021C E5          			PUSH	hl
0304   021D CD 74 04    			CALL	MOD02
0305   0220 E1          			POP		hl
0306   0221 F1          			POP		af
0307   0222 C3 AB 03    			JP		KEYLXX
0308   0225             ;
0309   0225 FE 22       KEYL05:		CP		$22 ; Shift-2 key - MOD-03: Serial Receive
0310   0227 C2 34 02    			JP		nz,KEYL06
0311   022A F5          			PUSH	af
0312   022B E5          			PUSH	hl
0313   022C CD 95 04    			CALL	MOD03
0314   022F E1          			POP		hl
0315   0230 F1          			POP		af
0316   0231 C3 AB 03    			JP		KEYLXX
0317   0234             ;
0318   0234 FE 23       KEYL06:		CP		$23 ; Shift-3 key.
0319   0236 C2 43 02    			JP		nz,KEYL07
0320   0239 F5          			PUSH	af
0321   023A E5          			PUSH	hl
0322   023B CD B6 04    			CALL	MOD04
0323   023E E1          			POP		hl
0324   023F F1          			POP		af
0325   0240 C3 AB 03    			JP		KEYLXX
0326   0243             ;
0327   0243 FE 24       KEYL07:		CP		$24 ; Shift-4 key.
0328   0245 C2 52 02    			JP		nz,KEYL08
0329   0248 F5          			PUSH	af
0330   0249 E5          			PUSH	hl
0331   024A CD B7 04    			CALL	MOD05
0332   024D E1          			POP		hl
0333   024E F1          			POP		af
0334   024F C3 AB 03    			JP		KEYLXX
0335   0252             ;
0336   0252 FE 25       KEYL08:		CP		$25 ; Shift-5 key.
0337   0254 C2 61 02    			JP		nz,KEYL09
0338   0257 F5          			PUSH	af
0339   0258 E5          			PUSH	hl
0340   0259 CD B8 04    			CALL	MOD06
0341   025C E1          			POP		hl
0342   025D F1          			POP		af
0343   025E C3 AB 03    			JP		KEYLXX
0344   0261             ;
0345   0261 FE 26       KEYL09:		CP		$26 ; Shift-6 key.
0346   0263 C2 70 02    			JP		nz,KEYL0A
0347   0266 F5          			PUSH	af
0348   0267 E5          			PUSH	hl
0349   0268 CD B9 04    			CALL	MOD07
0350   026B E1          			POP		hl
0351   026C F1          			POP		af
0352   026D C3 AB 03    			JP		KEYLXX
0353   0270             ;
0354   0270 FE 27       KEYL0A:		CP		$27 ; Shift-7 key.
0355   0272 C2 7F 02    			JP		nz,KEYL0B
0356   0275 F5          			PUSH	af
0357   0276 E5          			PUSH	hl
0358   0277 CD BA 04    			CALL	MOD08
0359   027A E1          			POP		hl
0360   027B F1          			POP		af
0361   027C C3 AB 03    			JP		KEYLXX
0362   027F             ;
0363   027F FE 28       KEYL0B:		CP		$28 ; Shift-8 key.
0364   0281 C2 8E 02    			JP		nz,KEYL0C
0365   0284 F5          			PUSH	af
0366   0285 E5          			PUSH	hl
0367   0286 CD BB 04    			CALL	MOD09
0368   0289 E1          			POP		hl
0369   028A F1          			POP		af
0370   028B C3 AB 03    			JP		KEYLXX
0371   028E             ;
0372   028E FE 29       KEYL0C:		CP		$29 ; Shift-9 key.
0373   0290 C2 9D 02    			JP		nz,KEYL0D
0374   0293 F5          			PUSH	af
0375   0294 E5          			PUSH	hl
0376   0295 CD BC 04    			CALL	MOD0A
0377   0298 E1          			POP		hl
0378   0299 F1          			POP		af
0379   029A C3 AB 03    			JP		KEYLXX
0380   029D             ;
0381   029D FE 2A       KEYL0D:		CP		$2A ; Shift-A key.
0382   029F C2 AC 02    			JP		nz,KEYL0E
0383   02A2 F5          			PUSH	af
0384   02A3 E5          			PUSH	hl
0385   02A4 CD BD 04    			CALL	MOD0B
0386   02A7 E1          			POP		hl
0387   02A8 F1          			POP		af
0388   02A9 C3 AB 03    			JP		KEYLXX
0389   02AC             ;
0390   02AC FE 2B       KEYL0E:		CP		$2B ; Shift-B key.
0391   02AE C2 BB 02    			JP		nz,KEYL0F
0392   02B1 F5          			PUSH	af
0393   02B2 E5          			PUSH	hl
0394   02B3 CD BE 04    			CALL	MOD0C
0395   02B6 E1          			POP		hl
0396   02B7 F1          			POP		af
0397   02B8 C3 AB 03    			JP		KEYLXX
0398   02BB             ;
0399   02BB FE 2C       KEYL0F:		CP		$2C ; Shift-C key.
0400   02BD C2 CA 02    			JP		nz,KEYL10
0401   02C0 F5          			PUSH	af
0402   02C1 E5          			PUSH	hl
0403   02C2 CD BF 04    			CALL	MOD0D
0404   02C5 E1          			POP		hl
0405   02C6 F1          			POP		af
0406   02C7 C3 AB 03    			JP		KEYLXX
0407   02CA             ;
0408   02CA FE 2D       KEYL10:		CP		$2D ; Shift-D key.
0409   02CC C2 D9 02    			JP		nz,KEYL11
0410   02CF F5          			PUSH	af
0411   02D0 E5          			PUSH	hl
0412   02D1 CD C0 04    			CALL	MOD0E
0413   02D4 E1          			POP		hl
0414   02D5 F1          			POP		af
0415   02D6 C3 AB 03    			JP		KEYLXX
0416   02D9             ;
0417   02D9 FE 2E       KEYL11:		CP		$2E ; Shift-E key.
0418   02DB C2 E8 02    			JP		nz,KEYL12
0419   02DE F5          			PUSH	af
0420   02DF E5          			PUSH	hl
0421   02E0 CD C1 04    			CALL	MOD0F
0422   02E3 E1          			POP		hl
0423   02E4 F1          			POP		af
0424   02E5 C3 AB 03    			JP		KEYLXX
0425   02E8             ;
0426   02E8 FE 2F       KEYL12:		CP		$2F ; Shift-F key - MOD-10: Serial Echo
0427   02EA C2 F7 02    			JP		nz,KEYL13
0428   02ED F5          			PUSH	af
0429   02EE E5          			PUSH	hl
0430   02EF CD C2 04    			CALL	MOD10
0431   02F2 E1          			POP		hl
0432   02F3 F1          			POP		af
0433   02F4 C3 AB 03    			JP		KEYLXX
0434   02F7             ;
0435   02F7 FE 30       KEYL13:		CP		$30 ; Shift-+ key.
0436   02F9 C2 1D 03    			JP		nz,KEYL14
0437   02FC 21 FF FF    			LD		hl,RAMTOP
0438   02FF ED 5B C1 08 			LD		de,(ADDRESS)
0439   0303 ED 52       			SBC		hl,de
0440   0305 44          			LD		b,h
0441   0306 4D          			LD		c,l
0442   0307 21 FF FF    			LD		hl,RAMTOP
0443   030A 54          			LD		d,h
0444   030B 5D          			LD		e,l
0445   030C 2B          			DEC		hl
0446   030D ED B8       			LDDR
0447   030F 62          			LD		h,d
0448   0310 6B          			LD		l,e
0449   0311 36 00       			LD		(hl),$00
0450   0313 21 C5 08    			LD		hl,MODE
0451   0316 CB 8E       			RES		1,(hl)
0452   0318 CB 96       			RES		2,(hl)
0453   031A C3 AB 03    			JP		KEYLXX
0454   031D             ;
0455   031D FE 31       KEYL14:		CP		$31 ; Shift-- key.
0456   031F C2 43 03    			JP		nz,KEYL15
0457   0322 21 FF FF    			LD		hl,RAMTOP
0458   0325 ED 5B C1 08 			LD		de,(ADDRESS)
0459   0329 ED 52       			SBC		hl,de
0460   032B 44          			LD		b,h
0461   032C 4D          			LD		c,l
0462   032D 2A C1 08    			LD		hl,(ADDRESS)
0463   0330 54          			LD		d,h
0464   0331 5D          			LD		e,l
0465   0332 23          			INC		hl
0466   0333 ED B0       			LDIR
0467   0335 62          			LD		h,d
0468   0336 6B          			LD		l,e
0469   0337 36 00       			LD		(hl),$00
0470   0339 21 C5 08    			LD		hl,MODE
0471   033C CB 8E       			RES		1,(hl)
0472   033E CB 96       			RES		2,(hl)
0473   0340 C3 AB 03    			JP		KEYLXX
0474   0343             ;
0475   0343 FE 32       KEYL15:		CP		$32 ; Shift-GO key.
0476   0345 CA AB 03    			JP		z,KEYLXX
0477   0348 FE 33       KEYL16:		CP		$33 ; Shift-AD key.
0478   034A CA AB 03    			JP		z,KEYLXX
0479   034D             ;
0480   034D 21 C5 08    KEYL17:		LD		hl,MODE ; Non-shifted digit keys entry.
0481   0350 CB 46       			BIT		0,(hl) ; 0 = Data Mode, 1 = Address Mode.
0482   0352 C2 86 03    			JP		nz,KEYL19
0483   0355 CB 4E       			BIT		1,(hl)
0484   0357 CA 72 03    			JP		z,KEYL17B ; Jump on 1st time through a data edit.
0485   035A CB 56       			BIT		2,(hl)
0486   035C CA 70 03    			JP		z,KEYL17A ; Jump on 2nd time through a data edit.
0487   035F CB 8E       			RES		1,(hl) ; Do this the 3rd time round a data edit.
0488   0361 CB 96       			RES		2,(hl)
0489   0363 2A C1 08    			LD		hl,(ADDRESS)
0490   0366 23          			INC		hl
0491   0367 22 C1 08    			LD		(ADDRESS),hl
0492   036A 21 C5 08    			LD		hl,MODE
0493   036D C3 72 03    			JP		KEYL17B
0494   0370 CB D6       KEYL17A:	SET		2,(hl)
0495   0372 CB 4E       KEYL17B:	BIT		1,(hl) ; 0 = first nibble, 1 = second nibble.
0496   0374 C2 7E 03    			JP		nz,KEYL18
0497   0377 CB CE       			SET		1,(hl)
0498   0379 2A C1 08    			LD		hl,(ADDRESS)
0499   037C 36 00       			LD		(hl),$00
0500   037E             ;
0501   037E 2A C1 08    KEYL18:		LD		hl,(ADDRESS)
0502   0381 ED 6F       			RLD
0503   0383 C3 AB 03    KEYL18A:	JP		KEYLXX
0504   0386             ;
0505   0386 CB 4E       KEYL19:		BIT		1,(hl) ; 0 = first nibble, 1 = subsequent nibbles.
0506   0388 C2 93 03    			JP		nz,KEYL1A
0507   038B CB CE       			SET		1,(hl)
0508   038D 21 00 00    			LD		hl,$0000
0509   0390 22 C1 08    			LD		(ADDRESS),hl
0510   0393             ;
0511   0393 21 C1 08    KEYL1A:		LD		hl,ADDRESS
0512   0396 ED 6F       			RLD
0513   0398 2A C1 08    			LD		hl,(ADDRESS)
0514   039B CB 24       			SLA		h
0515   039D CB 24       			SLA		h
0516   039F CB 24       			SLA		h
0517   03A1 CB 24       			SLA		h
0518   03A3 47          			LD		b,a
0519   03A4 AF          			XOR		a
0520   03A5 B4          			OR		h
0521   03A6 B0          			OR		b
0522   03A7 67          			LD		h,a
0523   03A8 22 C1 08    			LD		(ADDRESS),hl
0524   03AB             ;
0525   03AB 21 C6 08    KEYLXX:		LD		hl,KEYDATA ; Done with the key decoder.
0526   03AE 36 FF       			LD		(hl),$FF
0527   03B0 F1          			POP		af
0528   03B1 E1          			POP		hl
0529   03B2 C9          			RET
0530   03B3             ;
0531   03B3 E5          BEEP:		PUSH	hl
0532   03B4 F5          			PUSH	af
0533   03B5 21 C9 08    			LD		hl,BEEPFREQ
0534   03B8 4E          			LD		c,(hl)
0535   03B9 2A C7 08    			LD		hl,(BEEPLENGTH)
0536   03BC AF          			XOR		a
0537   03BD 57          			LD		d,a
0538   03BE 41          BEEPL01:	LD		b,c
0539   03BF 7A          			LD		a,d
0540   03C0 D3 01       			OUT		(CATHPORT),a
0541   03C2 10 FE       BEEPL02:	DJNZ	BEEPL02
0542   03C4 EE 80       			XOR		$80
0543   03C6 2B          			DEC		hl
0544   03C7 57          			LD		d,a
0545   03C8 7C          			LD		a,h
0546   03C9 B5          			OR		l
0547   03CA C2 BE 03    			JP		nz,BEEPL01
0548   03CD F1          			POP		af
0549   03CE E1          			POP		hl
0550   03CF C9          			RET
0551   03D0             ;
0552   03D0 E5          STARTBEEP:	PUSH	hl
0553   03D1 F5          			PUSH	af
0554   03D2 21 7F 00    			LD		hl,$007F
0555   03D5 22 C7 08    			LD		(BEEPLENGTH),hl
0556   03D8 21 C9 08    			LD		hl,BEEPFREQ
0557   03DB 36 35       			LD		(hl),$35
0558   03DD CD B3 03    			CALL	BEEP
0559   03E0 36 30       			LD		(hl),$30
0560   03E2 CD B3 03    			CALL	BEEP
0561   03E5 36 25       			LD		(hl),$25
0562   03E7 CD B3 03    			CALL	BEEP
0563   03EA 36 20       			LD		(hl),$20
0564   03EC CD B3 03    			CALL	BEEP
0565   03EF F1          			POP		af
0566   03F0 E1          			POP		hl
0567   03F1 C9          			RET
0568   03F2             ;			
0569   03F2 31 C0 08    SETUP:		LD		sp,STACKTOP ; Post reset/power up setup.
0570   03F5 21 00 09    			LD		hl,RAMBASE
0571   03F8 22 C1 08    			LD		(ADDRESS),hl
0572   03FB AF          			XOR		a
0573   03FC 32 C5 08    			LD		(MODE),a
0574   03FF 3E FF       			LD		a,$FF
0575   0401 32 C6 08    			LD		(KEYDATA),a
0576   0404 CD D0 03    			CALL	STARTBEEP
0577   0407             ;
0578   0407 CD 80 00    MAIN:		CALL	DISPLAY
0579   040A CD 97 01    			CALL	KEYBOARD
0580   040D C3 07 04    			JP		MAIN
0581   0410             ;
0582   0410 EB 28 CD AD HEX2SEG:	.DB		$EB,$28,$CD,$AD,$2E,$A7,$E7,$29 ; HEX Byte to LED Segment conversion.
0582   0414 2E A7 E7 29 
0583   0418 EF 2F 6F E6 			.DB		$EF,$2F,$6F,$E6,$C3,$EC,$C7,$47
0583   041C C3 EC C7 47 
0584   0420             ;
0585   0420             ; BEGIN MODULES.
0586   0420             ; START MOD-01 - Memory Test
0587   0420 2A F2 08    MOD01:		LD		hl,(M01FINISH)
0588   0423 23          			INC		hl
0589   0424 ED 5B F0 08 			LD		de,(M01START)
0590   0428 AF          			XOR		a
0591   0429 ED 52       			SBC		hl,de
0592   042B 44          			LD		b,h
0593   042C 4D          			LD		c,l
0594   042D ED 43 F2 08 			LD		(M01FINISH),bc
0595   0431 2A F0 08    			LD		hl,(M01START)
0596   0434 ED 5B F4 08 			LD		de,(M01PATTERN)
0597   0438 D9          			EXX
0598   0439 2A F0 08    			LD		hl,(M01START)
0599   043C ED 4B F2 08 			LD		bc,(M01FINISH)
0600   0440 ED 5B F4 08 			LD		de,(M01PATTERN)
0601   0444             ;
0602   0444 72          M01LDBLK:	LD		(hl),d
0603   0445 23          			INC		hl
0604   0446 0B          			DEC		bc
0605   0447 78          			LD		a,b
0606   0448 B1          			OR		c
0607   0449 C2 44 04    			JP		nz,M01LDBLK
0608   044C 11 00 00    			LD		de,$0000
0609   044F             ;
0610   044F 1B          M01DELAY:	DEC		de
0611   0450 7A          			LD		a,d
0612   0451 B3          			OR		e
0613   0452 C2 4F 04    			JP		nz,M01DELAY
0614   0455 11 00 00    			LD		de,$0000
0615   0458 D9          			EXX
0616   0459             ;
0617   0459 C3 62 04    M01TSTBLK:	JP		M01TEST01
0618   045C D9          M01TEST00:	EXX
0619   045D 13          			INC		de
0620   045E D9          			EXX
0621   045F C3 67 04    			JP		M01TEST02
0622   0462 7E          M01TEST01:	LD		a,(hl)
0623   0463 BA          			CP		d
0624   0464 C2 5C 04    			JP		nz,M01TEST00
0625   0467 23          M01TEST02:	INC		hl
0626   0468 0B          			DEC		bc
0627   0469 78          			LD		a,b
0628   046A B1          			OR		c
0629   046B C2 62 04    			JP		nz,M01TEST01
0630   046E             ;
0631   046E D9          M01STORE:	EXX
0632   046F ED 53 F0 08 			LD		(M01START),de
0633   0473 C9          			RET
0634   0474             ; END MOD-01
0635   0474             ;
0636   0474             ; START MOD-02 - Serial Send
0637   0474 DB 06       MOD02:		IN		a,(SERBUFFER)
0638   0476 2A F8 08    			LD		hl,(SEREND)
0639   0479 ED 5B F6 08 			LD		de,(SERSTART)
0640   047D ED 52       			SBC		hl,de
0641   047F EB          			EX		de,hl
0642   0480 3E 06       			LD		a,SERBUFFER
0643   0482 4F          			LD		c,a
0644   0483 43          			LD		b,e
0645   0484             ;
0646   0484 DB 07       M02MAIN:	IN		a,(SERSTATUS)
0647   0486 CB 47       			BIT		0,a
0648   0488 C2 84 04    			JP		nz,M02MAIN
0649   048B ED A3       			OUTI
0650   048D 7A          			LD		a,d
0651   048E B3          			OR		e
0652   048F C8          			RET		z
0653   0490 1B          			DEC		de
0654   0491 43          			LD		b,e
0655   0492 C3 84 04    			JP		M02MAIN
0656   0495             
0657   0495             ; END MOD-02
0658   0495             ;
0659   0495             ; START MOD-03 - Serial Receive
0660   0495 DB 06       MOD03:		IN		a,(SERBUFFER)
0661   0497 2A F8 08    			LD		hl,(SEREND)
0662   049A ED 5B F6 08 			LD		de,(SERSTART)
0663   049E ED 52       			SBC		hl,de
0664   04A0 EB          			EX		de,hl
0665   04A1 3E 06       			LD		a,SERBUFFER
0666   04A3 4F          			LD		c,a
0667   04A4 43          			LD		b,e
0668   04A5             ;
0669   04A5 DB 07       M03MAIN:	IN		a,(SERSTATUS)
0670   04A7 CB 4F       			BIT		1,a
0671   04A9 CA A5 04    			JP		z,M03MAIN
0672   04AC ED A2       			INI
0673   04AE 7A          			LD		a,d
0674   04AF B3          			OR		e
0675   04B0 C8          			RET		z
0676   04B1 1B          			DEC		de
0677   04B2 43          			LD		b,e
0678   04B3 C3 A5 04    			JP		M03MAIN
0679   04B6             ; END MOD-03
0680   04B6             ;
0681   04B6             ; START MOD-04 - xxxxx.
0682   04B6 C9          MOD04:		RET
0683   04B7             ; END MOD-04
0684   04B7             ;
0685   04B7             ; START MOD-05 - xxxxx.
0686   04B7 C9          MOD05:		RET
0687   04B8             ; END MOD-05
0688   04B8             ;
0689   04B8             ; START MOD-06 - xxxxx.
0690   04B8 C9          MOD06:		RET
0691   04B9             ; END MOD-06
0692   04B9             ;
0693   04B9             ; START MOD-07 - xxxxx.
0694   04B9 C9          MOD07:		RET
0695   04BA             ; END MOD-07
0696   04BA             ;
0697   04BA             ; START MOD-08 - xxxxx.
0698   04BA C9          MOD08:		RET
0699   04BB             ; END MOD-08
0700   04BB             ;
0701   04BB             ; START MOD-09 - xxxxx.
0702   04BB C9          MOD09:		RET
0703   04BC             ; END MOD-09
0704   04BC             ;
0705   04BC             ; START MOD-0A - xxxxx.
0706   04BC C9          MOD0A:		RET
0707   04BD             ; END MOD-0A
0708   04BD             ;
0709   04BD             ; START MOD-0B - xxxxx.
0710   04BD C9          MOD0B:		RET
0711   04BE             ; END MOD-0B
0712   04BE             ;
0713   04BE             ; START MOD-0C - xxxxx.
0714   04BE C9          MOD0C:		RET
0715   04BF             ; END MOD-0C
0716   04BF             ;
0717   04BF             ; START MOD-0D - xxxxx.
0718   04BF C9          MOD0D:		RET
0719   04C0             ; END MOD-0D
0720   04C0             ;
0721   04C0             ; START MOD-0E - xxxxx.
0722   04C0 C9          MOD0E:		RET
0723   04C1             ; END MOD-0E
0724   04C1             ;
0725   04C1             ; START MOD-0F - xxxxx.
0726   04C1 C9          MOD0F:		RET
0727   04C2             ; END MOD-0F
0728   04C2             ;
0729   04C2             ; START MOD-10 - Serial Echo
0730   04C2 DB 07       MOD10:		IN		a,(SERSTATUS)
0731   04C4 CB 4F       			BIT		1,a
0732   04C6 C4 CC 04    			CALL	nz,M10RCV ; Have we received data?
0733   04C9 C3 C2 04    			JP		MOD10
0734   04CC             
0735   04CC DB 06       M10RCV:		IN		a,(SERBUFFER)
0736   04CE 47          			LD		b,a
0737   04CF CD D3 04    			CALL	M10XMIT
0738   04D2 C9          			RET
0739   04D3             
0740   04D3 DB 07       M10XMIT:	IN		a,(SERSTATUS)
0741   04D5 CB 47       			BIT		0,a
0742   04D7 C2 D3 04    			JP		nz,M10XMIT
0743   04DA 78          			LD		a,b
0744   04DB D3 06       			OUT		(SERBUFFER),a
0745   04DD AF          			XOR		a
0746   04DE C9          			RET
0747   04DF             ; END MOD-10
0748   04DF             ;
0749   04DF             ; END MODULES.
0750   04DF             ;
0751   04DF             			.END
tasm: Number of errors = 0
