0001   0000             ; ######################################
0002   0000             ; #                                    #
0003   0000             ; #         uMON1 Version 1.00         #
0004   0000             ; #  --------------------------------  #
0005   0000             ; #   Special Key Sequences            #
0006   0000             ; #  --------------------------------  #
0007   0000             ; #   Shift-+ - Insert byte.           #
0008   0000             ; #   Shift-- - Delete byte.           #
0009   0000             ; #                                    #
0010   0000             ; #  --------------------------------  #
0011   0000             ; #                                    #
0012   0000             ; #  by Scott Gregory                  #
0013   0000             ; #  13/06/2021                        #
0014   0000             ; #                                    #
0015   0000             ; ######################################
0016   0000             ;
0017   0000             STACKTOP	.EQU	$08C0 ; Stack position.
0018   0000             ROMBASE		.EQU	$0000 ; Start of ROM.
0019   0000             ROMTOP		.EQU	$07FF ; End of ROM.
0020   0000             RAMBASE		.EQU	$0900 ; Start of user RAM.
0021   0000             RAMTOP		.EQU	$FFFF ; End of user RAM.
0022   0000             CATHDLY		.EQU	$20 ; Digit display delay.
0023   0000             KEYPORT		.EQU	$00 ; Keypad port.
0024   0000             CATHPORT	.EQU	$01 ; Display catchode port.
0025   0000             SEGPORT		.EQU	$02 ; Display segment port.
0026   0000             ;
0027   0000             ADDRESS		.EQU	$08C1 ; 2 Bytes.
0028   0000             SCRATCH		.EQU	$08C3 ; 2 Bytes.
0029   0000             MODE		.EQU	$08C5 ; 1 Byte.
0030   0000             KEYDATA		.EQU	$08C6 ; 1 Byte.
0031   0000             BEEPLENGTH	.EQU	$08C7 ; 2 Bytes.
0032   0000             BEEPFREQ	.EQU	$08C9 ; 1 Byte.
0033   0000             ;
0034   0000             ; Begin global MOD assignments.
0035   0000             ; End global MOD assignments.
0036   0000             ;
0037   0000             ; Begin MOD-xx assignments.
0038   0000             ; End MOD-xx assignments.
0039   0000             ;
0040   0000 00 00 00 00 			.FILL	(ROMTOP - ROMBASE) + 1, $00
0040   0004 00 00 00 00 
0040   0008 00 00 00 00 
0040   000C 00 00 00 00 
0040   0010 00 00 00 00 
0040   0014 00 00 00 00 
0040   0018 00 00 00 00 
0040   001C 00 00 00 00 
0040   0020 00 00 00 00 
0040   0024 00 00 00 00 
0040   0028 00 00 00 00 
0040   002C 00 00 00 00 
0040   0030 00 00 00 00 
0040   0034 00 00 00 00 
0040   0038 00 00 00 00 
0040   003C 00 00 00 00 
0040   0040 00 00 00 00 
0040   0044 00 00 00 00 
0040   0048 00 00 00 00 
0040   004C 00 00 00 00 
0040   0050 00 00 00 00 
0040   0054 00 00 00 00 
0040   0058 00 00 00 00 
0040   005C 00 00 00 00 
0040   0060 00 00 00 00 
0040   0064 00 00 00 00 
0040   0068 00 00 00 00 
0040   006C 00 00 00 00 
0040   0070 00 00 00 00 
0040   0074 00 00 00 00 
0040   0078 00 00 00 00 
0040   007C 00 00 00 00 
0040   0080 00 00 00 00 
0040   0084 00 00 00 00 
0040   0088 00 00 00 00 
0040   008C 00 00 00 00 
0040   0090 00 00 00 00 
0040   0094 00 00 00 00 
0040   0098 00 00 00 00 
0040   009C 00 00 00 00 
0040   00A0 00 00 00 00 
0040   00A4 00 00 00 00 
0040   00A8 00 00 00 00 
0040   00AC 00 00 00 00 
0040   00B0 00 00 00 00 
0040   00B4 00 00 00 00 
0040   00B8 00 00 00 00 
0040   00BC 00 00 00 00 
0040   00C0 00 00 00 00 
0040   00C4 00 00 00 00 
0040   00C8 00 00 00 00 
0040   00CC 00 00 00 00 
0040   00D0 00 00 00 00 
0040   00D4 00 00 00 00 
0040   00D8 00 00 00 00 
0040   00DC 00 00 00 00 
0040   00E0 00 00 00 00 
0040   00E4 00 00 00 00 
0040   00E8 00 00 00 00 
0040   00EC 00 00 00 00 
0040   00F0 00 00 00 00 
0040   00F4 00 00 00 00 
0040   00F8 00 00 00 00 
0040   00FC 00 00 00 00 
0040   0100 00 00 00 00 
0040   0104 00 00 00 00 
0040   0108 00 00 00 00 
0040   010C 00 00 00 00 
0040   0110 00 00 00 00 
0040   0114 00 00 00 00 
0040   0118 00 00 00 00 
0040   011C 00 00 00 00 
0040   0120 00 00 00 00 
0040   0124 00 00 00 00 
0040   0128 00 00 00 00 
0040   012C 00 00 00 00 
0040   0130 00 00 00 00 
0040   0134 00 00 00 00 
0040   0138 00 00 00 00 
0040   013C 00 00 00 00 
0040   0140 00 00 00 00 
0040   0144 00 00 00 00 
0040   0148 00 00 00 00 
0040   014C 00 00 00 00 
0040   0150 00 00 00 00 
0040   0154 00 00 00 00 
0040   0158 00 00 00 00 
0040   015C 00 00 00 00 
0040   0160 00 00 00 00 
0040   0164 00 00 00 00 
0040   0168 00 00 00 00 
0040   016C 00 00 00 00 
0040   0170 00 00 00 00 
0040   0174 00 00 00 00 
0040   0178 00 00 00 00 
0040   017C 00 00 00 00 
0040   0180 00 00 00 00 
0040   0184 00 00 00 00 
0040   0188 00 00 00 00 
0040   018C 00 00 00 00 
0040   0190 00 00 00 00 
0040   0194 00 00 00 00 
0040   0198 00 00 00 00 
0040   019C 00 00 00 00 
0040   01A0 00 00 00 00 
0040   01A4 00 00 00 00 
0040   01A8 00 00 00 00 
0040   01AC 00 00 00 00 
0040   01B0 00 00 00 00 
0040   01B4 00 00 00 00 
0040   01B8 00 00 00 00 
0040   01BC 00 00 00 00 
0040   01C0 00 00 00 00 
0040   01C4 00 00 00 00 
0040   01C8 00 00 00 00 
0040   01CC 00 00 00 00 
0040   01D0 00 00 00 00 
0040   01D4 00 00 00 00 
0040   01D8 00 00 00 00 
0040   01DC 00 00 00 00 
0040   01E0 00 00 00 00 
0040   01E4 00 00 00 00 
0040   01E8 00 00 00 00 
0040   01EC 00 00 00 00 
0040   01F0 00 00 00 00 
0040   01F4 00 00 00 00 
0040   01F8 00 00 00 00 
0040   01FC 00 00 00 00 
0040   0200 00 00 00 00 
0040   0204 00 00 00 00 
0040   0208 00 00 00 00 
0040   020C 00 00 00 00 
0040   0210 00 00 00 00 
0040   0214 00 00 00 00 
0040   0218 00 00 00 00 
0040   021C 00 00 00 00 
0040   0220 00 00 00 00 
0040   0224 00 00 00 00 
0040   0228 00 00 00 00 
0040   022C 00 00 00 00 
0040   0230 00 00 00 00 
0040   0234 00 00 00 00 
0040   0238 00 00 00 00 
0040   023C 00 00 00 00 
0040   0240 00 00 00 00 
0040   0244 00 00 00 00 
0040   0248 00 00 00 00 
0040   024C 00 00 00 00 
0040   0250 00 00 00 00 
0040   0254 00 00 00 00 
0040   0258 00 00 00 00 
0040   025C 00 00 00 00 
0040   0260 00 00 00 00 
0040   0264 00 00 00 00 
0040   0268 00 00 00 00 
0040   026C 00 00 00 00 
0040   0270 00 00 00 00 
0040   0274 00 00 00 00 
0040   0278 00 00 00 00 
0040   027C 00 00 00 00 
0040   0280 00 00 00 00 
0040   0284 00 00 00 00 
0040   0288 00 00 00 00 
0040   028C 00 00 00 00 
0040   0290 00 00 00 00 
0040   0294 00 00 00 00 
0040   0298 00 00 00 00 
0040   029C 00 00 00 00 
0040   02A0 00 00 00 00 
0040   02A4 00 00 00 00 
0040   02A8 00 00 00 00 
0040   02AC 00 00 00 00 
0040   02B0 00 00 00 00 
0040   02B4 00 00 00 00 
0040   02B8 00 00 00 00 
0040   02BC 00 00 00 00 
0040   02C0 00 00 00 00 
0040   02C4 00 00 00 00 
0040   02C8 00 00 00 00 
0040   02CC 00 00 00 00 
0040   02D0 00 00 00 00 
0040   02D4 00 00 00 00 
0040   02D8 00 00 00 00 
0040   02DC 00 00 00 00 
0040   02E0 00 00 00 00 
0040   02E4 00 00 00 00 
0040   02E8 00 00 00 00 
0040   02EC 00 00 00 00 
0040   02F0 00 00 00 00 
0040   02F4 00 00 00 00 
0040   02F8 00 00 00 00 
0040   02FC 00 00 00 00 
0040   0300 00 00 00 00 
0040   0304 00 00 00 00 
0040   0308 00 00 00 00 
0040   030C 00 00 00 00 
0040   0310 00 00 00 00 
0040   0314 00 00 00 00 
0040   0318 00 00 00 00 
0040   031C 00 00 00 00 
0040   0320 00 00 00 00 
0040   0324 00 00 00 00 
0040   0328 00 00 00 00 
0040   032C 00 00 00 00 
0040   0330 00 00 00 00 
0040   0334 00 00 00 00 
0040   0338 00 00 00 00 
0040   033C 00 00 00 00 
0040   0340 00 00 00 00 
0040   0344 00 00 00 00 
0040   0348 00 00 00 00 
0040   034C 00 00 00 00 
0040   0350 00 00 00 00 
0040   0354 00 00 00 00 
0040   0358 00 00 00 00 
0040   035C 00 00 00 00 
0040   0360 00 00 00 00 
0040   0364 00 00 00 00 
0040   0368 00 00 00 00 
0040   036C 00 00 00 00 
0040   0370 00 00 00 00 
0040   0374 00 00 00 00 
0040   0378 00 00 00 00 
0040   037C 00 00 00 00 
0040   0380 00 00 00 00 
0040   0384 00 00 00 00 
0040   0388 00 00 00 00 
0040   038C 00 00 00 00 
0040   0390 00 00 00 00 
0040   0394 00 00 00 00 
0040   0398 00 00 00 00 
0040   039C 00 00 00 00 
0040   03A0 00 00 00 00 
0040   03A4 00 00 00 00 
0040   03A8 00 00 00 00 
0040   03AC 00 00 00 00 
0040   03B0 00 00 00 00 
0040   03B4 00 00 00 00 
0040   03B8 00 00 00 00 
0040   03BC 00 00 00 00 
0040   03C0 00 00 00 00 
0040   03C4 00 00 00 00 
0040   03C8 00 00 00 00 
0040   03CC 00 00 00 00 
0040   03D0 00 00 00 00 
0040   03D4 00 00 00 00 
0040   03D8 00 00 00 00 
0040   03DC 00 00 00 00 
0040   03E0 00 00 00 00 
0040   03E4 00 00 00 00 
0040   03E8 00 00 00 00 
0040   03EC 00 00 00 00 
0040   03F0 00 00 00 00 
0040   03F4 00 00 00 00 
0040   03F8 00 00 00 00 
0040   03FC 00 00 00 00 
0040   0400 00 00 00 00 
0040   0404 00 00 00 00 
0040   0408 00 00 00 00 
0040   040C 00 00 00 00 
0040   0410 00 00 00 00 
0040   0414 00 00 00 00 
0040   0418 00 00 00 00 
0040   041C 00 00 00 00 
0040   0420 00 00 00 00 
0040   0424 00 00 00 00 
0040   0428 00 00 00 00 
0040   042C 00 00 00 00 
0040   0430 00 00 00 00 
0040   0434 00 00 00 00 
0040   0438 00 00 00 00 
0040   043C 00 00 00 00 
0040   0440 00 00 00 00 
0040   0444 00 00 00 00 
0040   0448 00 00 00 00 
0040   044C 00 00 00 00 
0040   0450 00 00 00 00 
0040   0454 00 00 00 00 
0040   0458 00 00 00 00 
0040   045C 00 00 00 00 
0040   0460 00 00 00 00 
0040   0464 00 00 00 00 
0040   0468 00 00 00 00 
0040   046C 00 00 00 00 
0040   0470 00 00 00 00 
0040   0474 00 00 00 00 
0040   0478 00 00 00 00 
0040   047C 00 00 00 00 
0040   0480 00 00 00 00 
0040   0484 00 00 00 00 
0040   0488 00 00 00 00 
0040   048C 00 00 00 00 
0040   0490 00 00 00 00 
0040   0494 00 00 00 00 
0040   0498 00 00 00 00 
0040   049C 00 00 00 00 
0040   04A0 00 00 00 00 
0040   04A4 00 00 00 00 
0040   04A8 00 00 00 00 
0040   04AC 00 00 00 00 
0040   04B0 00 00 00 00 
0040   04B4 00 00 00 00 
0040   04B8 00 00 00 00 
0040   04BC 00 00 00 00 
0040   04C0 00 00 00 00 
0040   04C4 00 00 00 00 
0040   04C8 00 00 00 00 
0040   04CC 00 00 00 00 
0040   04D0 00 00 00 00 
0040   04D4 00 00 00 00 
0040   04D8 00 00 00 00 
0040   04DC 00 00 00 00 
0040   04E0 00 00 00 00 
0040   04E4 00 00 00 00 
0040   04E8 00 00 00 00 
0040   04EC 00 00 00 00 
0040   04F0 00 00 00 00 
0040   04F4 00 00 00 00 
0040   04F8 00 00 00 00 
0040   04FC 00 00 00 00 
0040   0500 00 00 00 00 
0040   0504 00 00 00 00 
0040   0508 00 00 00 00 
0040   050C 00 00 00 00 
0040   0510 00 00 00 00 
0040   0514 00 00 00 00 
0040   0518 00 00 00 00 
0040   051C 00 00 00 00 
0040   0520 00 00 00 00 
0040   0524 00 00 00 00 
0040   0528 00 00 00 00 
0040   052C 00 00 00 00 
0040   0530 00 00 00 00 
0040   0534 00 00 00 00 
0040   0538 00 00 00 00 
0040   053C 00 00 00 00 
0040   0540 00 00 00 00 
0040   0544 00 00 00 00 
0040   0548 00 00 00 00 
0040   054C 00 00 00 00 
0040   0550 00 00 00 00 
0040   0554 00 00 00 00 
0040   0558 00 00 00 00 
0040   055C 00 00 00 00 
0040   0560 00 00 00 00 
0040   0564 00 00 00 00 
0040   0568 00 00 00 00 
0040   056C 00 00 00 00 
0040   0570 00 00 00 00 
0040   0574 00 00 00 00 
0040   0578 00 00 00 00 
0040   057C 00 00 00 00 
0040   0580 00 00 00 00 
0040   0584 00 00 00 00 
0040   0588 00 00 00 00 
0040   058C 00 00 00 00 
0040   0590 00 00 00 00 
0040   0594 00 00 00 00 
0040   0598 00 00 00 00 
0040   059C 00 00 00 00 
0040   05A0 00 00 00 00 
0040   05A4 00 00 00 00 
0040   05A8 00 00 00 00 
0040   05AC 00 00 00 00 
0040   05B0 00 00 00 00 
0040   05B4 00 00 00 00 
0040   05B8 00 00 00 00 
0040   05BC 00 00 00 00 
0040   05C0 00 00 00 00 
0040   05C4 00 00 00 00 
0040   05C8 00 00 00 00 
0040   05CC 00 00 00 00 
0040   05D0 00 00 00 00 
0040   05D4 00 00 00 00 
0040   05D8 00 00 00 00 
0040   05DC 00 00 00 00 
0040   05E0 00 00 00 00 
0040   05E4 00 00 00 00 
0040   05E8 00 00 00 00 
0040   05EC 00 00 00 00 
0040   05F0 00 00 00 00 
0040   05F4 00 00 00 00 
0040   05F8 00 00 00 00 
0040   05FC 00 00 00 00 
0040   0600 00 00 00 00 
0040   0604 00 00 00 00 
0040   0608 00 00 00 00 
0040   060C 00 00 00 00 
0040   0610 00 00 00 00 
0040   0614 00 00 00 00 
0040   0618 00 00 00 00 
0040   061C 00 00 00 00 
0040   0620 00 00 00 00 
0040   0624 00 00 00 00 
0040   0628 00 00 00 00 
0040   062C 00 00 00 00 
0040   0630 00 00 00 00 
0040   0634 00 00 00 00 
0040   0638 00 00 00 00 
0040   063C 00 00 00 00 
0040   0640 00 00 00 00 
0040   0644 00 00 00 00 
0040   0648 00 00 00 00 
0040   064C 00 00 00 00 
0040   0650 00 00 00 00 
0040   0654 00 00 00 00 
0040   0658 00 00 00 00 
0040   065C 00 00 00 00 
0040   0660 00 00 00 00 
0040   0664 00 00 00 00 
0040   0668 00 00 00 00 
0040   066C 00 00 00 00 
0040   0670 00 00 00 00 
0040   0674 00 00 00 00 
0040   0678 00 00 00 00 
0040   067C 00 00 00 00 
0040   0680 00 00 00 00 
0040   0684 00 00 00 00 
0040   0688 00 00 00 00 
0040   068C 00 00 00 00 
0040   0690 00 00 00 00 
0040   0694 00 00 00 00 
0040   0698 00 00 00 00 
0040   069C 00 00 00 00 
0040   06A0 00 00 00 00 
0040   06A4 00 00 00 00 
0040   06A8 00 00 00 00 
0040   06AC 00 00 00 00 
0040   06B0 00 00 00 00 
0040   06B4 00 00 00 00 
0040   06B8 00 00 00 00 
0040   06BC 00 00 00 00 
0040   06C0 00 00 00 00 
0040   06C4 00 00 00 00 
0040   06C8 00 00 00 00 
0040   06CC 00 00 00 00 
0040   06D0 00 00 00 00 
0040   06D4 00 00 00 00 
0040   06D8 00 00 00 00 
0040   06DC 00 00 00 00 
0040   06E0 00 00 00 00 
0040   06E4 00 00 00 00 
0040   06E8 00 00 00 00 
0040   06EC 00 00 00 00 
0040   06F0 00 00 00 00 
0040   06F4 00 00 00 00 
0040   06F8 00 00 00 00 
0040   06FC 00 00 00 00 
0040   0700 00 00 00 00 
0040   0704 00 00 00 00 
0040   0708 00 00 00 00 
0040   070C 00 00 00 00 
0040   0710 00 00 00 00 
0040   0714 00 00 00 00 
0040   0718 00 00 00 00 
0040   071C 00 00 00 00 
0040   0720 00 00 00 00 
0040   0724 00 00 00 00 
0040   0728 00 00 00 00 
0040   072C 00 00 00 00 
0040   0730 00 00 00 00 
0040   0734 00 00 00 00 
0040   0738 00 00 00 00 
0040   073C 00 00 00 00 
0040   0740 00 00 00 00 
0040   0744 00 00 00 00 
0040   0748 00 00 00 00 
0040   074C 00 00 00 00 
0040   0750 00 00 00 00 
0040   0754 00 00 00 00 
0040   0758 00 00 00 00 
0040   075C 00 00 00 00 
0040   0760 00 00 00 00 
0040   0764 00 00 00 00 
0040   0768 00 00 00 00 
0040   076C 00 00 00 00 
0040   0770 00 00 00 00 
0040   0774 00 00 00 00 
0040   0778 00 00 00 00 
0040   077C 00 00 00 00 
0040   0780 00 00 00 00 
0040   0784 00 00 00 00 
0040   0788 00 00 00 00 
0040   078C 00 00 00 00 
0040   0790 00 00 00 00 
0040   0794 00 00 00 00 
0040   0798 00 00 00 00 
0040   079C 00 00 00 00 
0040   07A0 00 00 00 00 
0040   07A4 00 00 00 00 
0040   07A8 00 00 00 00 
0040   07AC 00 00 00 00 
0040   07B0 00 00 00 00 
0040   07B4 00 00 00 00 
0040   07B8 00 00 00 00 
0040   07BC 00 00 00 00 
0040   07C0 00 00 00 00 
0040   07C4 00 00 00 00 
0040   07C8 00 00 00 00 
0040   07CC 00 00 00 00 
0040   07D0 00 00 00 00 
0040   07D4 00 00 00 00 
0040   07D8 00 00 00 00 
0040   07DC 00 00 00 00 
0040   07E0 00 00 00 00 
0040   07E4 00 00 00 00 
0040   07E8 00 00 00 00 
0040   07EC 00 00 00 00 
0040   07F0 00 00 00 00 
0040   07F4 00 00 00 00 
0040   07F8 00 00 00 00 
0040   07FC 00 00 00 00 
0041   0000             			.ORG	$0000
0042   0000 C3 5C 03    RESET_00:	JP		SETUP
0043   0003             ;
0044   0008             			.ORG	$0008
0045   0008 C3 5C 03    RESET_08:	JP		SETUP
0046   000B             ;
0047   0010             			.ORG	$0010
0048   0010 C3 5C 03    RESET_10:	JP		SETUP
0049   0013             ;
0050   0018             			.ORG	$0018
0051   0018 C3 5C 03    RESET_18:	JP		SETUP
0052   001B             ;
0053   0020             			.ORG	$0020
0054   0020 C3 5C 03    RESET_20:	JP		SETUP
0055   0023             ;
0056   0028             			.ORG	$0028
0057   0028 C3 5C 03    RESET_28:	JP		SETUP
0058   002B             ;
0059   0030             			.ORG	$0030
0060   0030 C3 5C 03    RESET_30:	JP		SETUP
0061   0033             ;
0062   0038             			.ORG	$0038
0063   0038 C3 5C 03    RESET_38:	JP		SETUP
0064   003B             ;
0065   0040             			.ORG	$0040
0066   0040 75 4D 4F 4E VERSION:	.TEXT	"uMON V1.00 by Scott Gregory"
0066   0044 20 56 31 2E 
0066   0048 30 30 20 62 
0066   004C 79 20 53 63 
0066   0050 6F 74 74 20 
0066   0054 47 72 65 67 
0066   0058 6F 72 79 
0067   005B             ;
0068   0066             			.ORG	$0066
0069   0066 F5          NMISERVICE:	PUSH	af ; Keyboard service routine.
0070   0067 DB 00       			IN		a,(KEYPORT)
0071   0069 32 C6 08    			LD		(KEYDATA),a
0072   006C F1          			POP		af
0073   006D ED 45       			RETN
0074   006F             ;
0075   0080             			.ORG	$0080
0076   0080 AF          DISPLAY:	XOR		a ; Display update routine.
0077   0081 D3 01       			OUT		(CATHPORT),a
0078   0083 D3 02       			OUT		(SEGPORT),a
0079   0085 4F          			LD		c,a
0080   0086 CB E9       			SET		5,c
0081   0088 ED 5B C1 08 			LD		de,(ADDRESS)
0082   008C 7A          			LD		a,d
0083   008D 32 C3 08    			LD		(SCRATCH),a
0084   0090 AF          			XOR		a
0085   0091 21 C3 08    			LD		hl,SCRATCH
0086   0094 ED 6F       			RLD
0087   0096 DD 21 7A 03 			LD		ix,HEX2SEG
0088   009A 16 00       			LD		d,$00
0089   009C 5F          			LD		e,a
0090   009D DD 19       			ADD		ix,de
0091   009F DD 7E 00    			LD		a,(ix)
0092   00A2 E5          			PUSH	hl
0093   00A3 21 C5 08    			LD		hl,MODE
0094   00A6 CB 46       			BIT		0,(hl)
0095   00A8 CA AD 00    			JP		z,DISL00
0096   00AB F6 10       			OR		$10
0097   00AD E1          DISL00:		POP		hl
0098   00AE D3 02       			OUT		(SEGPORT),a
0099   00B0 79          			LD		a,c
0100   00B1 D3 01       			OUT		(CATHPORT),a
0101   00B3 06 20       			LD		b,CATHDLY
0102   00B5 10 FE       DISL01:		DJNZ	DISL01
0103   00B7 AF          			XOR		a
0104   00B8 D3 01       			OUT		(CATHPORT),a
0105   00BA D3 02       			OUT		(SEGPORT),a
0106   00BC CB 19       			RR			c
0107   00BE ED 6F       			RLD
0108   00C0 DD 21 7A 03 			LD		ix,HEX2SEG
0109   00C4 16 00       			LD		d,$00
0110   00C6 5F          			LD		e,a
0111   00C7 DD 19       			ADD		ix,de
0112   00C9 DD 7E 00    			LD		a,(ix)
0113   00CC E5          			PUSH	hl
0114   00CD 21 C5 08    			LD		hl,MODE
0115   00D0 CB 46       			BIT		0,(hl)
0116   00D2 CA D7 00    			JP		z,DISL02
0117   00D5 F6 10       			OR		$10
0118   00D7 E1          DISL02:		POP		hl
0119   00D8 D3 02       			OUT		(SEGPORT),a
0120   00DA 79          			LD		a,c
0121   00DB D3 01       			OUT		(CATHPORT),a
0122   00DD 06 20       			LD		b,CATHDLY
0123   00DF 10 FE       DISL03:		DJNZ	DISL03
0124   00E1 AF          			XOR		a
0125   00E2 D3 01       			OUT		(CATHPORT),a
0126   00E4 D3 02       			OUT		(SEGPORT),a
0127   00E6 CB 19       			RR		c
0128   00E8 ED 5B C1 08 			LD		de,(ADDRESS)
0129   00EC 7B          			LD		a,e
0130   00ED 32 C3 08    			LD		(SCRATCH),a
0131   00F0 AF          			XOR		a
0132   00F1 21 C3 08    			LD		hl,SCRATCH
0133   00F4 ED 6F       			RLD
0134   00F6 DD 21 7A 03 			LD		ix,HEX2SEG
0135   00FA 16 00       			LD		d,$00
0136   00FC 5F          			LD		e,a
0137   00FD DD 19       			ADD		ix,de
0138   00FF DD 7E 00    			LD		a,(ix)
0139   0102 E5          			PUSH	hl
0140   0103 21 C5 08    			LD		hl,MODE
0141   0106 CB 46       			BIT		0,(hl)
0142   0108 CA 0D 01    			JP		z,DISL04
0143   010B F6 10       			OR		$10
0144   010D E1          DISL04:		POP		hl
0145   010E D3 02       			OUT		(SEGPORT),a
0146   0110 79          			LD		a,c
0147   0111 D3 01       			OUT		(CATHPORT),a
0148   0113 06 20       			LD			b,CATHDLY
0149   0115 10 FE       DISL05:		DJNZ	DISL05
0150   0117 AF          			XOR		a
0151   0118 D3 01       			OUT		(CATHPORT),a
0152   011A D3 02       			OUT		(SEGPORT),a
0153   011C CB 19       			RR		c
0154   011E ED 6F       			RLD
0155   0120 DD 21 7A 03 			LD		ix,HEX2SEG
0156   0124 16 00       			LD		d,$00
0157   0126 5F          			LD		e,a
0158   0127 DD 19       			ADD		ix,de
0159   0129 DD 7E 00    			LD		a,(ix)
0160   012C E5          			PUSH	hl
0161   012D 21 C5 08    			LD		hl,MODE
0162   0130 CB 46       			BIT		0,(hl)
0163   0132 CA 37 01    			JP		z,DISL06
0164   0135 F6 10       			OR		$10
0165   0137 E1          DISL06:		POP		hl
0166   0138 D3 02       			OUT		(SEGPORT),a
0167   013A 79          			LD		a,c
0168   013B D3 01       			OUT		(CATHPORT),a
0169   013D 06 20       			LD		b,CATHDLY
0170   013F 10 FE       DISL07:		DJNZ	DISL07
0171   0141 AF          			XOR		a
0172   0142 D3 02       			OUT		(SEGPORT),a
0173   0144 D3 01       			OUT		(CATHPORT),a
0174   0146 CB 19       			RR		c
0175   0148 2A C1 08    			LD		hl,(ADDRESS)
0176   014B 7E          			LD		a,(hl)
0177   014C 32 C3 08    			LD		(SCRATCH),a
0178   014F AF          			XOR		a
0179   0150 21 C3 08    			LD		hl,SCRATCH
0180   0153 ED 6F       			RLD
0181   0155 DD 21 7A 03 			LD		ix,HEX2SEG
0182   0159 16 00       			LD		d,$00
0183   015B 5F          			LD		e,a
0184   015C DD 19       			ADD		ix,de
0185   015E DD 7E 00    			LD		a,(ix)
0186   0161 E5          			PUSH	hl
0187   0162 21 C5 08    			LD		hl,MODE
0188   0165 CB 46       			BIT		0,(hl)
0189   0167 C2 6C 01    			JP		nz,DISL08
0190   016A F6 10       			OR		$10
0191   016C E1          DISL08:		POP		hl
0192   016D D3 02       			OUT		(SEGPORT),a
0193   016F 79          			LD		a,c
0194   0170 D3 01       			OUT		(CATHPORT),a
0195   0172 06 20       			LD		b,CATHDLY
0196   0174 10 FE       DISL09:		DJNZ	DISL09
0197   0176 AF          			XOR		a
0198   0177 D3 02       			OUT		(SEGPORT),a
0199   0179 D3 01       			OUT		(CATHPORT),a
0200   017B CB 19       			RR		c
0201   017D ED 6F       			RLD
0202   017F DD 21 7A 03 			LD		ix,HEX2SEG
0203   0183 16 00       			LD		d,$00
0204   0185 5F          			LD		e,a
0205   0186 DD 19       			ADD		ix,de
0206   0188 DD 7E 00    			LD		a,(ix)
0207   018B E5          			PUSH	hl
0208   018C 21 C5 08    			LD		hl,MODE
0209   018F CB 46       			BIT		0,(hl)
0210   0191 C2 96 01    			JP		nz,DISL0A
0211   0194 F6 10       			OR		$10
0212   0196 E1          DISL0A:		POP		hl
0213   0197 D3 02       			OUT		($02),a
0214   0199 79          			LD		a,c
0215   019A D3 01       			OUT		($01),a
0216   019C 06 20       			LD		b,CATHDLY
0217   019E 10 FE       DISL0B:		DJNZ	DISL0B
0218   01A0 C9          			RET
0219   01A1             ;
0220   01A1 E5          KEYBOARD:	PUSH	hl ; Key decoder routine.
0221   01A2 F5          			PUSH	af
0222   01A3 21 30 00    			LD		hl,$0030
0223   01A6 22 C7 08    			LD		(BEEPLENGTH),hl
0224   01A9 21 C9 08    			LD		hl,BEEPFREQ
0225   01AC 36 30       			LD		(hl),$30
0226   01AE 21 C6 08    			LD		hl,KEYDATA
0227   01B1 3E FF       			LD		a,$FF
0228   01B3 BE          			CP		(hl)
0229   01B4 CA 15 03    			JP		z,KEYLXX
0230   01B7 CD 1D 03    			CALL	BEEP
0231   01BA 7E          			LD		a,(hl)
0232   01BB E6 3F       			AND		$3f ; We only want the first 6 bits.
0233   01BD EE 20       			XOR		$20 ; Flip bit 6 (Shift key) because it gives a 1 when not being pressed.
0234   01BF             ;
0235   01BF FE 10       			CP		$10 ; + key.
0236   01C1 C2 D7 01    			JP		nz,KEYL00
0237   01C4 2A C1 08    			LD		hl,(ADDRESS)
0238   01C7 23          			INC		hl
0239   01C8 22 C1 08    			LD		(ADDRESS),hl
0240   01CB 21 C5 08    			LD		hl,MODE
0241   01CE CB 86       			RES		0,(hl)
0242   01D0 CB 8E       			RES		1,(hl)
0243   01D2 CB 96       			RES		2,(hl)
0244   01D4 C3 15 03    			JP		KEYLXX
0245   01D7             ;
0246   01D7 FE 11       KEYL00:		CP		$11 ; - key.
0247   01D9 C2 EF 01    			JP		nz,KEYL01
0248   01DC 2A C1 08    			LD		hl,(ADDRESS)
0249   01DF 2B          			DEC		hl
0250   01E0 22 C1 08    			LD		(ADDRESS),hl
0251   01E3 21 C5 08    			LD		hl,MODE
0252   01E6 CB 86       			RES		0,(hl)
0253   01E8 CB 8E       			RES		1,(hl)
0254   01EA CB 96       			RES		2,(hl)
0255   01EC C3 15 03    			JP		KEYLXX
0256   01EF             ;
0257   01EF FE 12       KEYL01:		CP		$12 ; GO key.
0258   01F1 C2 FB 01    			JP		nz,KEYL02
0259   01F4 31 C0 08    			LD		sp,STACKTOP
0260   01F7 2A C1 08    			LD		hl,(ADDRESS)
0261   01FA E9          			JP		(hl)
0262   01FB             ;
0263   01FB FE 13       KEYL02:		CP		$13 ; AD key.
0264   01FD C2 11 02    			JP		nz,KEYL03
0265   0200 47          			LD		b,a
0266   0201 3A C5 08    			LD		a,(MODE)
0267   0204 EE 01       			XOR		$01
0268   0206 CB 8F       			RES		1,a
0269   0208 CB 97       			RES		2,a
0270   020A 32 C5 08    			LD		(MODE),a
0271   020D 78          			LD		a,b
0272   020E C3 15 03    			JP		KEYLXX
0273   0211             ;
0274   0211 FE 20       KEYL03:		CP		$20 ; Shift-0 key.
0275   0213 CA 15 03    			JP		z,KEYLXX
0276   0216 FE 21       KEYL04:		CP		$21 ; Shift-1 key.
0277   0218 CA 15 03    			JP		z,KEYLXX
0278   021B FE 22       KEYL05:		CP		$22 ; Shift-2 key.
0279   021D CA 15 03    			JP		z,KEYLXX
0280   0220 FE 23       KEYL06:		CP		$23 ; Shift-3 key.
0281   0222 CA 15 03    			JP		z,KEYLXX
0282   0225 FE 24       KEYL07:		CP		$24 ; Shift-4 key.
0283   0227 CA 15 03    			JP		z,KEYLXX
0284   022A FE 25       KEYL08:		CP		$25 ; Shift-5 key.
0285   022C CA 15 03    			JP		z,KEYLXX
0286   022F FE 26       KEYL09:		CP		$26 ; Shift-6 key.
0287   0231 CA 15 03    			JP		z,KEYLXX
0288   0234 FE 27       KEYL0A:		CP		$27 ; Shift-7 key.
0289   0236 CA 15 03    			JP		z,KEYLXX
0290   0239 FE 28       KEYL0B:		CP		$28 ; Shift-8 key.
0291   023B CA 15 03    			JP		z,KEYLXX
0292   023E FE 29       KEYL0C:		CP		$29 ; Shift-9 key.
0293   0240 CA 15 03    			JP		z,KEYLXX
0294   0243 FE 2A       KEYL0D:		CP		$2A ; Shift-A key.
0295   0245 CA 15 03    			JP		z,KEYLXX
0296   0248 FE 2B       KEYL0E:		CP		$2B ; Shift-B key.
0297   024A CA 15 03    			JP		z,KEYLXX
0298   024D FE 2C       KEYL0F:		CP		$2C ; Shift-C key.
0299   024F CA 15 03    			JP		z,KEYLXX
0300   0252 FE 2D       KEYL10:		CP		$2D ; Shift-D key.
0301   0254 CA 15 03    			JP		z,KEYLXX
0302   0257 FE 2E       KEYL11:		CP		$2E ; Shift-E key.
0303   0259 CA 15 03    			JP		z,KEYLXX
0304   025C FE 2F       KEYL12:		CP		$2F ; Shift-F key.
0305   025E CA 15 03    			JP		z,KEYLXX
0306   0261             ;
0307   0261 FE 30       KEYL13:		CP		$30 ; Shift-+ key.
0308   0263 C2 87 02    			JP		nz,KEYL14
0309   0266 21 FF FF    			LD		hl,RAMTOP
0310   0269 ED 5B C1 08 			LD		de,(ADDRESS)
0311   026D ED 52       			SBC		hl,de
0312   026F 44          			LD		b,h
0313   0270 4D          			LD		c,l
0314   0271 21 FF FF    			LD		hl,RAMTOP
0315   0274 54          			LD		d,h
0316   0275 5D          			LD		e,l
0317   0276 2B          			DEC		hl
0318   0277 ED B8       			LDDR
0319   0279 62          			LD		h,d
0320   027A 6B          			LD		l,e
0321   027B 36 00       			LD		(hl),$00
0322   027D 21 C5 08    			LD		hl,MODE
0323   0280 CB 8E       			RES		1,(hl)
0324   0282 CB 96       			RES		2,(hl)
0325   0284 C3 15 03    			JP		KEYLXX
0326   0287             ;
0327   0287 FE 31       KEYL14:		CP		$31 ; Shift-- key.
0328   0289 C2 AD 02    			JP		nz,KEYL15
0329   028C 21 FF FF    			LD		hl,RAMTOP
0330   028F ED 5B C1 08 			LD		de,(ADDRESS)
0331   0293 ED 52       			SBC		hl,de
0332   0295 44          			LD		b,h
0333   0296 4D          			LD		c,l
0334   0297 2A C1 08    			LD		hl,(ADDRESS)
0335   029A 54          			LD		d,h
0336   029B 5D          			LD		e,l
0337   029C 23          			INC		hl
0338   029D ED B0       			LDIR
0339   029F 62          			LD		h,d
0340   02A0 6B          			LD		l,e
0341   02A1 36 00       			LD		(hl),$00
0342   02A3 21 C5 08    			LD		hl,MODE
0343   02A6 CB 8E       			RES		1,(hl)
0344   02A8 CB 96       			RES		2,(hl)
0345   02AA C3 15 03    			JP		KEYLXX
0346   02AD             ;
0347   02AD FE 32       KEYL15:		CP		$32 ; Shift-GO key.
0348   02AF CA 15 03    			JP		z,KEYLXX
0349   02B2 FE 33       KEYL16:		CP		$33 ; Shift-AD key.
0350   02B4 CA 15 03    			JP		z,KEYLXX
0351   02B7             ;
0352   02B7 21 C5 08    KEYL17:		LD		hl,MODE ; Non-shifted digit keys entry.
0353   02BA CB 46       			BIT		0,(hl) ; 0 = Data Mode, 1 = Address Mode.
0354   02BC C2 F0 02    			JP		nz,KEYL19
0355   02BF CB 4E       			BIT		1,(hl)
0356   02C1 CA DC 02    			JP		z,KEYL17B ; Jump on 1st time through a data edit.
0357   02C4 CB 56       			BIT		2,(hl)
0358   02C6 CA DA 02    			JP		z,KEYL17A ; Jump on 2nd time through a data edit.
0359   02C9 CB 8E       			RES		1,(hl) ; Do this the 3rd time round a data edit.
0360   02CB CB 96       			RES		2,(hl)
0361   02CD 2A C1 08    			LD		hl,(ADDRESS)
0362   02D0 23          			INC		hl
0363   02D1 22 C1 08    			LD		(ADDRESS),hl
0364   02D4 21 C5 08    			LD		hl,MODE
0365   02D7 C3 DC 02    			JP		KEYL17B
0366   02DA CB D6       KEYL17A:	SET		2,(hl)
0367   02DC CB 4E       KEYL17B:	BIT		1,(hl) ; 0 = first nibble, 1 = second nibble.
0368   02DE C2 E8 02    			JP		nz,KEYL18
0369   02E1 CB CE       			SET		1,(hl)
0370   02E3 2A C1 08    			LD		hl,(ADDRESS)
0371   02E6 36 00       			LD		(hl),$00
0372   02E8             ;
0373   02E8 2A C1 08    KEYL18:		LD		hl,(ADDRESS)
0374   02EB ED 6F       			RLD
0375   02ED C3 15 03    KEYL18A:	JP		KEYLXX
0376   02F0             ;
0377   02F0 CB 4E       KEYL19:		BIT		1,(hl) ; 0 = first nibble, 1 = subsequent nibbles.
0378   02F2 C2 FD 02    			JP		nz,KEYL1A
0379   02F5 CB CE       			SET		1,(hl)
0380   02F7 21 00 00    			LD		hl,$0000
0381   02FA 22 C1 08    			LD		(ADDRESS),hl
0382   02FD             ;
0383   02FD 21 C1 08    KEYL1A:		LD		hl,ADDRESS
0384   0300 ED 6F       			RLD
0385   0302 2A C1 08    			LD		hl,(ADDRESS)
0386   0305 CB 24       			SLA		h
0387   0307 CB 24       			SLA		h
0388   0309 CB 24       			SLA		h
0389   030B CB 24       			SLA		h
0390   030D 47          			LD		b,a
0391   030E AF          			XOR		a
0392   030F B4          			OR		h
0393   0310 B0          			OR		b
0394   0311 67          			LD		h,a
0395   0312 22 C1 08    			LD		(ADDRESS),hl
0396   0315             ;
0397   0315 21 C6 08    KEYLXX:		LD		hl,KEYDATA ; Done with the key decoder.
0398   0318 36 FF       			LD		(hl),$FF
0399   031A F1          			POP		af
0400   031B E1          			POP		hl
0401   031C C9          			RET
0402   031D             ;
0403   031D E5          BEEP:		PUSH	hl
0404   031E F5          			PUSH	af
0405   031F 21 C9 08    			LD		hl,BEEPFREQ
0406   0322 4E          			LD		c,(hl)
0407   0323 2A C7 08    			LD		hl,(BEEPLENGTH)
0408   0326 AF          			XOR		a
0409   0327 57          			LD		d,a
0410   0328 41          BEEPL01:	LD		b,c
0411   0329 7A          			LD		a,d
0412   032A D3 01       			OUT		(CATHPORT),a
0413   032C 10 FE       BEEPL02:	DJNZ	BEEPL02
0414   032E EE 80       			XOR		$80
0415   0330 2B          			DEC		hl
0416   0331 57          			LD		d,a
0417   0332 7C          			LD		a,h
0418   0333 B5          			OR		l
0419   0334 C2 28 03    			JP		nz,BEEPL01
0420   0337 F1          			POP		af
0421   0338 E1          			POP		hl
0422   0339 C9          			RET
0423   033A             ;
0424   033A E5          STARTBEEP:	PUSH	hl
0425   033B F5          			PUSH	af
0426   033C 21 7F 00    			LD		hl,$007F
0427   033F 22 C7 08    			LD		(BEEPLENGTH),hl
0428   0342 21 C9 08    			LD		hl,BEEPFREQ
0429   0345 36 35       			LD		(hl),$35
0430   0347 CD 1D 03    			CALL	BEEP
0431   034A 36 30       			LD		(hl),$30
0432   034C CD 1D 03    			CALL	BEEP
0433   034F 36 25       			LD		(hl),$25
0434   0351 CD 1D 03    			CALL	BEEP
0435   0354 36 20       			LD		(hl),$20
0436   0356 CD 1D 03    			CALL	BEEP
0437   0359 F1          			POP		af
0438   035A E1          			POP		hl
0439   035B C9          			RET
0440   035C             ;			
0441   035C 31 C0 08    SETUP:		LD		sp,STACKTOP ; Post reset/power up setup.
0442   035F 21 00 09    			LD		hl,RAMBASE
0443   0362 22 C1 08    			LD		(ADDRESS),hl
0444   0365 AF          			XOR		a
0445   0366 32 C5 08    			LD		(MODE),a
0446   0369 3E FF       			LD		a,$FF
0447   036B 32 C6 08    			LD		(KEYDATA),a
0448   036E CD 3A 03    			CALL	STARTBEEP
0449   0371             ;
0450   0371 CD 80 00    MAIN:		CALL	DISPLAY
0451   0374 CD A1 01    			CALL	KEYBOARD
0452   0377 C3 71 03    			JP		MAIN
0453   037A             ;
0454   037A EB 28 CD AD HEX2SEG:	.DB		$EB,$28,$CD,$AD,$2E,$A7,$E7,$29 ; HEX Byte to LED Segment conversion.
0454   037E 2E A7 E7 29 
0455   0382 EF 2F 6F E6 			.DB		$EF,$2F,$6F,$E6,$C3,$EC,$C7,$47
0455   0386 C3 EC C7 47 
0456   038A             ;
0457   038A             ; BEGIN MODULES.
0458   038A             ; START MOD-xx - xxxxx.
0459   038A             ; END MOD-xx
0460   038A             ;
0461   038A             ; END MODULES.
0462   038A             ;
0463   038A             			.END
tasm: Number of errors = 0
