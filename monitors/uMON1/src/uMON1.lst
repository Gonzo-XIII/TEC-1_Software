0001   0000             ; ######################################
0002   0000             ; #                                    #
0003   0000             ; #         uMON1 Version 1.03         #
0004   0000             ; #  --------------------------------  #
0005   0000             ; #   Special Key Sequences            #
0006   0000             ; #  --------------------------------  #
0007   0000             ; #   Shift-+ - Insert byte.           #
0008   0000             ; #   Shift-- - Delete byte.           #
0009   0000             ; #                                    #
0010   0000             ; #  --------------------------------  #
0011   0000             ; #                                    #
0012   0000             ; #  by Scott Gregory                  #
0013   0000             ; #  13/06/2021                        #
0014   0000             ; #                                    #
0015   0000             ; ######################################
0016   0000             ;
0017   0000             STACKTOP	.EQU	$08C0 ; Stack position.
0018   0000             ROMBASE		.EQU	$0000 ; Start of ROM.
0019   0000             ROMTOP		.EQU	$07FF ; End of ROM.
0020   0000             RAMBASE		.EQU	$0900 ; Start of user RAM.
0021   0000             RAMTOP		.EQU	$FFFF ; End of user RAM.
0022   0000             CATHDLY		.EQU	$40 ; Digit display delay.
0023   0000             KEYPORT		.EQU	$00 ; Keypad port.
0024   0000             CATHPORT	.EQU	$01 ; Display catchode port.
0025   0000             SEGPORT		.EQU	$02 ; Display segment port.
0026   0000             ;
0027   0000             ADDRESS		.EQU	$08C1 ; 2 Bytes.
0028   0000             SCRATCH		.EQU	$08C3 ; 2 Bytes.
0029   0000             MODE		.EQU	$08C5 ; 1 Byte.
0030   0000             KEYDATA		.EQU	$08C6 ; 1 Byte.
0031   0000             BEEPLENGTH	.EQU	$08C7 ; 2 Bytes.
0032   0000             BEEPFREQ	.EQU	$08C9 ; 1 Byte.
0033   0000             ;
0034   0000             ; Begin global MOD assignments.
0035   0000             ; End global MOD assignments.
0036   0000             ;
0037   0000             ; Begin MOD-xx assignments.
0038   0000             ; End MOD-xx assignments.
0039   0000             ;
0040   0000 00 00 00 00 			.FILL	(ROMTOP - ROMBASE) + 1, $00
0040   0004 00 00 00 00 
0040   0008 00 00 00 00 
0040   000C 00 00 00 00 
0040   0010 00 00 00 00 
0040   0014 00 00 00 00 
0040   0018 00 00 00 00 
0040   001C 00 00 00 00 
0040   0020 00 00 00 00 
0040   0024 00 00 00 00 
0040   0028 00 00 00 00 
0040   002C 00 00 00 00 
0040   0030 00 00 00 00 
0040   0034 00 00 00 00 
0040   0038 00 00 00 00 
0040   003C 00 00 00 00 
0040   0040 00 00 00 00 
0040   0044 00 00 00 00 
0040   0048 00 00 00 00 
0040   004C 00 00 00 00 
0040   0050 00 00 00 00 
0040   0054 00 00 00 00 
0040   0058 00 00 00 00 
0040   005C 00 00 00 00 
0040   0060 00 00 00 00 
0040   0064 00 00 00 00 
0040   0068 00 00 00 00 
0040   006C 00 00 00 00 
0040   0070 00 00 00 00 
0040   0074 00 00 00 00 
0040   0078 00 00 00 00 
0040   007C 00 00 00 00 
0040   0080 00 00 00 00 
0040   0084 00 00 00 00 
0040   0088 00 00 00 00 
0040   008C 00 00 00 00 
0040   0090 00 00 00 00 
0040   0094 00 00 00 00 
0040   0098 00 00 00 00 
0040   009C 00 00 00 00 
0040   00A0 00 00 00 00 
0040   00A4 00 00 00 00 
0040   00A8 00 00 00 00 
0040   00AC 00 00 00 00 
0040   00B0 00 00 00 00 
0040   00B4 00 00 00 00 
0040   00B8 00 00 00 00 
0040   00BC 00 00 00 00 
0040   00C0 00 00 00 00 
0040   00C4 00 00 00 00 
0040   00C8 00 00 00 00 
0040   00CC 00 00 00 00 
0040   00D0 00 00 00 00 
0040   00D4 00 00 00 00 
0040   00D8 00 00 00 00 
0040   00DC 00 00 00 00 
0040   00E0 00 00 00 00 
0040   00E4 00 00 00 00 
0040   00E8 00 00 00 00 
0040   00EC 00 00 00 00 
0040   00F0 00 00 00 00 
0040   00F4 00 00 00 00 
0040   00F8 00 00 00 00 
0040   00FC 00 00 00 00 
0040   0100 00 00 00 00 
0040   0104 00 00 00 00 
0040   0108 00 00 00 00 
0040   010C 00 00 00 00 
0040   0110 00 00 00 00 
0040   0114 00 00 00 00 
0040   0118 00 00 00 00 
0040   011C 00 00 00 00 
0040   0120 00 00 00 00 
0040   0124 00 00 00 00 
0040   0128 00 00 00 00 
0040   012C 00 00 00 00 
0040   0130 00 00 00 00 
0040   0134 00 00 00 00 
0040   0138 00 00 00 00 
0040   013C 00 00 00 00 
0040   0140 00 00 00 00 
0040   0144 00 00 00 00 
0040   0148 00 00 00 00 
0040   014C 00 00 00 00 
0040   0150 00 00 00 00 
0040   0154 00 00 00 00 
0040   0158 00 00 00 00 
0040   015C 00 00 00 00 
0040   0160 00 00 00 00 
0040   0164 00 00 00 00 
0040   0168 00 00 00 00 
0040   016C 00 00 00 00 
0040   0170 00 00 00 00 
0040   0174 00 00 00 00 
0040   0178 00 00 00 00 
0040   017C 00 00 00 00 
0040   0180 00 00 00 00 
0040   0184 00 00 00 00 
0040   0188 00 00 00 00 
0040   018C 00 00 00 00 
0040   0190 00 00 00 00 
0040   0194 00 00 00 00 
0040   0198 00 00 00 00 
0040   019C 00 00 00 00 
0040   01A0 00 00 00 00 
0040   01A4 00 00 00 00 
0040   01A8 00 00 00 00 
0040   01AC 00 00 00 00 
0040   01B0 00 00 00 00 
0040   01B4 00 00 00 00 
0040   01B8 00 00 00 00 
0040   01BC 00 00 00 00 
0040   01C0 00 00 00 00 
0040   01C4 00 00 00 00 
0040   01C8 00 00 00 00 
0040   01CC 00 00 00 00 
0040   01D0 00 00 00 00 
0040   01D4 00 00 00 00 
0040   01D8 00 00 00 00 
0040   01DC 00 00 00 00 
0040   01E0 00 00 00 00 
0040   01E4 00 00 00 00 
0040   01E8 00 00 00 00 
0040   01EC 00 00 00 00 
0040   01F0 00 00 00 00 
0040   01F4 00 00 00 00 
0040   01F8 00 00 00 00 
0040   01FC 00 00 00 00 
0040   0200 00 00 00 00 
0040   0204 00 00 00 00 
0040   0208 00 00 00 00 
0040   020C 00 00 00 00 
0040   0210 00 00 00 00 
0040   0214 00 00 00 00 
0040   0218 00 00 00 00 
0040   021C 00 00 00 00 
0040   0220 00 00 00 00 
0040   0224 00 00 00 00 
0040   0228 00 00 00 00 
0040   022C 00 00 00 00 
0040   0230 00 00 00 00 
0040   0234 00 00 00 00 
0040   0238 00 00 00 00 
0040   023C 00 00 00 00 
0040   0240 00 00 00 00 
0040   0244 00 00 00 00 
0040   0248 00 00 00 00 
0040   024C 00 00 00 00 
0040   0250 00 00 00 00 
0040   0254 00 00 00 00 
0040   0258 00 00 00 00 
0040   025C 00 00 00 00 
0040   0260 00 00 00 00 
0040   0264 00 00 00 00 
0040   0268 00 00 00 00 
0040   026C 00 00 00 00 
0040   0270 00 00 00 00 
0040   0274 00 00 00 00 
0040   0278 00 00 00 00 
0040   027C 00 00 00 00 
0040   0280 00 00 00 00 
0040   0284 00 00 00 00 
0040   0288 00 00 00 00 
0040   028C 00 00 00 00 
0040   0290 00 00 00 00 
0040   0294 00 00 00 00 
0040   0298 00 00 00 00 
0040   029C 00 00 00 00 
0040   02A0 00 00 00 00 
0040   02A4 00 00 00 00 
0040   02A8 00 00 00 00 
0040   02AC 00 00 00 00 
0040   02B0 00 00 00 00 
0040   02B4 00 00 00 00 
0040   02B8 00 00 00 00 
0040   02BC 00 00 00 00 
0040   02C0 00 00 00 00 
0040   02C4 00 00 00 00 
0040   02C8 00 00 00 00 
0040   02CC 00 00 00 00 
0040   02D0 00 00 00 00 
0040   02D4 00 00 00 00 
0040   02D8 00 00 00 00 
0040   02DC 00 00 00 00 
0040   02E0 00 00 00 00 
0040   02E4 00 00 00 00 
0040   02E8 00 00 00 00 
0040   02EC 00 00 00 00 
0040   02F0 00 00 00 00 
0040   02F4 00 00 00 00 
0040   02F8 00 00 00 00 
0040   02FC 00 00 00 00 
0040   0300 00 00 00 00 
0040   0304 00 00 00 00 
0040   0308 00 00 00 00 
0040   030C 00 00 00 00 
0040   0310 00 00 00 00 
0040   0314 00 00 00 00 
0040   0318 00 00 00 00 
0040   031C 00 00 00 00 
0040   0320 00 00 00 00 
0040   0324 00 00 00 00 
0040   0328 00 00 00 00 
0040   032C 00 00 00 00 
0040   0330 00 00 00 00 
0040   0334 00 00 00 00 
0040   0338 00 00 00 00 
0040   033C 00 00 00 00 
0040   0340 00 00 00 00 
0040   0344 00 00 00 00 
0040   0348 00 00 00 00 
0040   034C 00 00 00 00 
0040   0350 00 00 00 00 
0040   0354 00 00 00 00 
0040   0358 00 00 00 00 
0040   035C 00 00 00 00 
0040   0360 00 00 00 00 
0040   0364 00 00 00 00 
0040   0368 00 00 00 00 
0040   036C 00 00 00 00 
0040   0370 00 00 00 00 
0040   0374 00 00 00 00 
0040   0378 00 00 00 00 
0040   037C 00 00 00 00 
0040   0380 00 00 00 00 
0040   0384 00 00 00 00 
0040   0388 00 00 00 00 
0040   038C 00 00 00 00 
0040   0390 00 00 00 00 
0040   0394 00 00 00 00 
0040   0398 00 00 00 00 
0040   039C 00 00 00 00 
0040   03A0 00 00 00 00 
0040   03A4 00 00 00 00 
0040   03A8 00 00 00 00 
0040   03AC 00 00 00 00 
0040   03B0 00 00 00 00 
0040   03B4 00 00 00 00 
0040   03B8 00 00 00 00 
0040   03BC 00 00 00 00 
0040   03C0 00 00 00 00 
0040   03C4 00 00 00 00 
0040   03C8 00 00 00 00 
0040   03CC 00 00 00 00 
0040   03D0 00 00 00 00 
0040   03D4 00 00 00 00 
0040   03D8 00 00 00 00 
0040   03DC 00 00 00 00 
0040   03E0 00 00 00 00 
0040   03E4 00 00 00 00 
0040   03E8 00 00 00 00 
0040   03EC 00 00 00 00 
0040   03F0 00 00 00 00 
0040   03F4 00 00 00 00 
0040   03F8 00 00 00 00 
0040   03FC 00 00 00 00 
0040   0400 00 00 00 00 
0040   0404 00 00 00 00 
0040   0408 00 00 00 00 
0040   040C 00 00 00 00 
0040   0410 00 00 00 00 
0040   0414 00 00 00 00 
0040   0418 00 00 00 00 
0040   041C 00 00 00 00 
0040   0420 00 00 00 00 
0040   0424 00 00 00 00 
0040   0428 00 00 00 00 
0040   042C 00 00 00 00 
0040   0430 00 00 00 00 
0040   0434 00 00 00 00 
0040   0438 00 00 00 00 
0040   043C 00 00 00 00 
0040   0440 00 00 00 00 
0040   0444 00 00 00 00 
0040   0448 00 00 00 00 
0040   044C 00 00 00 00 
0040   0450 00 00 00 00 
0040   0454 00 00 00 00 
0040   0458 00 00 00 00 
0040   045C 00 00 00 00 
0040   0460 00 00 00 00 
0040   0464 00 00 00 00 
0040   0468 00 00 00 00 
0040   046C 00 00 00 00 
0040   0470 00 00 00 00 
0040   0474 00 00 00 00 
0040   0478 00 00 00 00 
0040   047C 00 00 00 00 
0040   0480 00 00 00 00 
0040   0484 00 00 00 00 
0040   0488 00 00 00 00 
0040   048C 00 00 00 00 
0040   0490 00 00 00 00 
0040   0494 00 00 00 00 
0040   0498 00 00 00 00 
0040   049C 00 00 00 00 
0040   04A0 00 00 00 00 
0040   04A4 00 00 00 00 
0040   04A8 00 00 00 00 
0040   04AC 00 00 00 00 
0040   04B0 00 00 00 00 
0040   04B4 00 00 00 00 
0040   04B8 00 00 00 00 
0040   04BC 00 00 00 00 
0040   04C0 00 00 00 00 
0040   04C4 00 00 00 00 
0040   04C8 00 00 00 00 
0040   04CC 00 00 00 00 
0040   04D0 00 00 00 00 
0040   04D4 00 00 00 00 
0040   04D8 00 00 00 00 
0040   04DC 00 00 00 00 
0040   04E0 00 00 00 00 
0040   04E4 00 00 00 00 
0040   04E8 00 00 00 00 
0040   04EC 00 00 00 00 
0040   04F0 00 00 00 00 
0040   04F4 00 00 00 00 
0040   04F8 00 00 00 00 
0040   04FC 00 00 00 00 
0040   0500 00 00 00 00 
0040   0504 00 00 00 00 
0040   0508 00 00 00 00 
0040   050C 00 00 00 00 
0040   0510 00 00 00 00 
0040   0514 00 00 00 00 
0040   0518 00 00 00 00 
0040   051C 00 00 00 00 
0040   0520 00 00 00 00 
0040   0524 00 00 00 00 
0040   0528 00 00 00 00 
0040   052C 00 00 00 00 
0040   0530 00 00 00 00 
0040   0534 00 00 00 00 
0040   0538 00 00 00 00 
0040   053C 00 00 00 00 
0040   0540 00 00 00 00 
0040   0544 00 00 00 00 
0040   0548 00 00 00 00 
0040   054C 00 00 00 00 
0040   0550 00 00 00 00 
0040   0554 00 00 00 00 
0040   0558 00 00 00 00 
0040   055C 00 00 00 00 
0040   0560 00 00 00 00 
0040   0564 00 00 00 00 
0040   0568 00 00 00 00 
0040   056C 00 00 00 00 
0040   0570 00 00 00 00 
0040   0574 00 00 00 00 
0040   0578 00 00 00 00 
0040   057C 00 00 00 00 
0040   0580 00 00 00 00 
0040   0584 00 00 00 00 
0040   0588 00 00 00 00 
0040   058C 00 00 00 00 
0040   0590 00 00 00 00 
0040   0594 00 00 00 00 
0040   0598 00 00 00 00 
0040   059C 00 00 00 00 
0040   05A0 00 00 00 00 
0040   05A4 00 00 00 00 
0040   05A8 00 00 00 00 
0040   05AC 00 00 00 00 
0040   05B0 00 00 00 00 
0040   05B4 00 00 00 00 
0040   05B8 00 00 00 00 
0040   05BC 00 00 00 00 
0040   05C0 00 00 00 00 
0040   05C4 00 00 00 00 
0040   05C8 00 00 00 00 
0040   05CC 00 00 00 00 
0040   05D0 00 00 00 00 
0040   05D4 00 00 00 00 
0040   05D8 00 00 00 00 
0040   05DC 00 00 00 00 
0040   05E0 00 00 00 00 
0040   05E4 00 00 00 00 
0040   05E8 00 00 00 00 
0040   05EC 00 00 00 00 
0040   05F0 00 00 00 00 
0040   05F4 00 00 00 00 
0040   05F8 00 00 00 00 
0040   05FC 00 00 00 00 
0040   0600 00 00 00 00 
0040   0604 00 00 00 00 
0040   0608 00 00 00 00 
0040   060C 00 00 00 00 
0040   0610 00 00 00 00 
0040   0614 00 00 00 00 
0040   0618 00 00 00 00 
0040   061C 00 00 00 00 
0040   0620 00 00 00 00 
0040   0624 00 00 00 00 
0040   0628 00 00 00 00 
0040   062C 00 00 00 00 
0040   0630 00 00 00 00 
0040   0634 00 00 00 00 
0040   0638 00 00 00 00 
0040   063C 00 00 00 00 
0040   0640 00 00 00 00 
0040   0644 00 00 00 00 
0040   0648 00 00 00 00 
0040   064C 00 00 00 00 
0040   0650 00 00 00 00 
0040   0654 00 00 00 00 
0040   0658 00 00 00 00 
0040   065C 00 00 00 00 
0040   0660 00 00 00 00 
0040   0664 00 00 00 00 
0040   0668 00 00 00 00 
0040   066C 00 00 00 00 
0040   0670 00 00 00 00 
0040   0674 00 00 00 00 
0040   0678 00 00 00 00 
0040   067C 00 00 00 00 
0040   0680 00 00 00 00 
0040   0684 00 00 00 00 
0040   0688 00 00 00 00 
0040   068C 00 00 00 00 
0040   0690 00 00 00 00 
0040   0694 00 00 00 00 
0040   0698 00 00 00 00 
0040   069C 00 00 00 00 
0040   06A0 00 00 00 00 
0040   06A4 00 00 00 00 
0040   06A8 00 00 00 00 
0040   06AC 00 00 00 00 
0040   06B0 00 00 00 00 
0040   06B4 00 00 00 00 
0040   06B8 00 00 00 00 
0040   06BC 00 00 00 00 
0040   06C0 00 00 00 00 
0040   06C4 00 00 00 00 
0040   06C8 00 00 00 00 
0040   06CC 00 00 00 00 
0040   06D0 00 00 00 00 
0040   06D4 00 00 00 00 
0040   06D8 00 00 00 00 
0040   06DC 00 00 00 00 
0040   06E0 00 00 00 00 
0040   06E4 00 00 00 00 
0040   06E8 00 00 00 00 
0040   06EC 00 00 00 00 
0040   06F0 00 00 00 00 
0040   06F4 00 00 00 00 
0040   06F8 00 00 00 00 
0040   06FC 00 00 00 00 
0040   0700 00 00 00 00 
0040   0704 00 00 00 00 
0040   0708 00 00 00 00 
0040   070C 00 00 00 00 
0040   0710 00 00 00 00 
0040   0714 00 00 00 00 
0040   0718 00 00 00 00 
0040   071C 00 00 00 00 
0040   0720 00 00 00 00 
0040   0724 00 00 00 00 
0040   0728 00 00 00 00 
0040   072C 00 00 00 00 
0040   0730 00 00 00 00 
0040   0734 00 00 00 00 
0040   0738 00 00 00 00 
0040   073C 00 00 00 00 
0040   0740 00 00 00 00 
0040   0744 00 00 00 00 
0040   0748 00 00 00 00 
0040   074C 00 00 00 00 
0040   0750 00 00 00 00 
0040   0754 00 00 00 00 
0040   0758 00 00 00 00 
0040   075C 00 00 00 00 
0040   0760 00 00 00 00 
0040   0764 00 00 00 00 
0040   0768 00 00 00 00 
0040   076C 00 00 00 00 
0040   0770 00 00 00 00 
0040   0774 00 00 00 00 
0040   0778 00 00 00 00 
0040   077C 00 00 00 00 
0040   0780 00 00 00 00 
0040   0784 00 00 00 00 
0040   0788 00 00 00 00 
0040   078C 00 00 00 00 
0040   0790 00 00 00 00 
0040   0794 00 00 00 00 
0040   0798 00 00 00 00 
0040   079C 00 00 00 00 
0040   07A0 00 00 00 00 
0040   07A4 00 00 00 00 
0040   07A8 00 00 00 00 
0040   07AC 00 00 00 00 
0040   07B0 00 00 00 00 
0040   07B4 00 00 00 00 
0040   07B8 00 00 00 00 
0040   07BC 00 00 00 00 
0040   07C0 00 00 00 00 
0040   07C4 00 00 00 00 
0040   07C8 00 00 00 00 
0040   07CC 00 00 00 00 
0040   07D0 00 00 00 00 
0040   07D4 00 00 00 00 
0040   07D8 00 00 00 00 
0040   07DC 00 00 00 00 
0040   07E0 00 00 00 00 
0040   07E4 00 00 00 00 
0040   07E8 00 00 00 00 
0040   07EC 00 00 00 00 
0040   07F0 00 00 00 00 
0040   07F4 00 00 00 00 
0040   07F8 00 00 00 00 
0040   07FC 00 00 00 00 
0041   0000             			.ORG	$0000
0042   0000 C3 E8 03    RESET_00:	JP		SETUP
0043   0003             ;
0044   0008             			.ORG	$0008
0045   0008 C3 E8 03    RESET_08:	JP		SETUP
0046   000B             ;
0047   0010             			.ORG	$0010
0048   0010 C3 E8 03    RESET_10:	JP		SETUP
0049   0013             ;
0050   0018             			.ORG	$0018
0051   0018 C3 E8 03    RESET_18:	JP		SETUP
0052   001B             ;
0053   0020             			.ORG	$0020
0054   0020 C3 E8 03    RESET_20:	JP		SETUP
0055   0023             ;
0056   0028             			.ORG	$0028
0057   0028 C3 E8 03    RESET_28:	JP		SETUP
0058   002B             ;
0059   0030             			.ORG	$0030
0060   0030 C3 E8 03    RESET_30:	JP		SETUP
0061   0033             ;
0062   0038             			.ORG	$0038
0063   0038 C3 E8 03    RESET_38:	JP		SETUP
0064   003B             ;
0065   0040             			.ORG	$0040
0066   0040 75 4D 4F 4E VERSION:	.TEXT	"uMON V1.03 by Scott Gregory"
0066   0044 20 56 31 2E 
0066   0048 30 33 20 62 
0066   004C 79 20 53 63 
0066   0050 6F 74 74 20 
0066   0054 47 72 65 67 
0066   0058 6F 72 79 
0067   005B             ;
0068   0066             			.ORG	$0066
0069   0066 F5          NMISERVICE:	PUSH	af ; Keyboard service routine.
0070   0067 DB 00       			IN		a,(KEYPORT)
0071   0069 32 C6 08    			LD		(KEYDATA),a
0072   006C F1          			POP		af
0073   006D ED 45       			RETN
0074   006F             ;
0075   0080             			.ORG	$0080
0076   0080 AF          DISPLAY:	XOR		a ; Display update routine.
0077   0081 D3 01       			OUT		(CATHPORT),a
0078   0083 D3 02       			OUT		(SEGPORT),a
0079   0085 4F          			LD		c,a
0080   0086 CB E9       			SET		5,c
0081   0088 ED 5B C1 08 			LD		de,(ADDRESS)
0082   008C 7A          			LD		a,d
0083   008D 32 C3 08    			LD		(SCRATCH),a
0084   0090 AF          			XOR		a
0085   0091 21 C3 08    			LD		hl,SCRATCH
0086   0094 ED 6F       			RLD
0087   0096 DD 21 06 04 			LD		ix,HEX2SEG
0088   009A 16 00       			LD		d,$00
0089   009C 5F          			LD		e,a
0090   009D DD 19       			ADD		ix,de
0091   009F DD 7E 00    			LD		a,(ix)
0092   00A2 E5          			PUSH	hl
0093   00A3 21 C5 08    			LD		hl,MODE
0094   00A6 CB 46       			BIT		0,(hl)
0095   00A8 CA AD 00    			JP		z,DISL00
0096   00AB F6 10       			OR		$10
0097   00AD E1          DISL00:		POP		hl
0098   00AE D3 02       			OUT		(SEGPORT),a
0099   00B0 79          			LD		a,c
0100   00B1 D3 01       			OUT		(CATHPORT),a
0101   00B3 06 40       			LD		b,CATHDLY
0102   00B5 10 FE       DISL01:		DJNZ	DISL01
0103   00B7 AF          			XOR		a
0104   00B8 D3 01       			OUT		(CATHPORT),a
0105   00BA CB 19       			RR		c
0106   00BC ED 6F       			RLD
0107   00BE DD 21 06 04 			LD		ix,HEX2SEG
0108   00C2 16 00       			LD		d,$00
0109   00C4 5F          			LD		e,a
0110   00C5 DD 19       			ADD		ix,de
0111   00C7 DD 7E 00    			LD		a,(ix)
0112   00CA E5          			PUSH	hl
0113   00CB 21 C5 08    			LD		hl,MODE
0114   00CE CB 46       			BIT		0,(hl)
0115   00D0 CA D5 00    			JP		z,DISL02
0116   00D3 F6 10       			OR		$10
0117   00D5 E1          DISL02:		POP		hl
0118   00D6 D3 02       			OUT		(SEGPORT),a
0119   00D8 79          			LD		a,c
0120   00D9 D3 01       			OUT		(CATHPORT),a
0121   00DB 06 40       			LD		b,CATHDLY
0122   00DD 10 FE       DISL03:		DJNZ	DISL03
0123   00DF AF          			XOR		a
0124   00E0 D3 01       			OUT		(CATHPORT),a
0125   00E2 CB 19       			RR		c
0126   00E4 ED 5B C1 08 			LD		de,(ADDRESS)
0127   00E8 7B          			LD		a,e
0128   00E9 32 C3 08    			LD		(SCRATCH),a
0129   00EC AF          			XOR		a
0130   00ED 21 C3 08    			LD		hl,SCRATCH
0131   00F0 ED 6F       			RLD
0132   00F2 DD 21 06 04 			LD		ix,HEX2SEG
0133   00F6 16 00       			LD		d,$00
0134   00F8 5F          			LD		e,a
0135   00F9 DD 19       			ADD		ix,de
0136   00FB DD 7E 00    			LD		a,(ix)
0137   00FE E5          			PUSH	hl
0138   00FF 21 C5 08    			LD		hl,MODE
0139   0102 CB 46       			BIT		0,(hl)
0140   0104 CA 09 01    			JP		z,DISL04
0141   0107 F6 10       			OR		$10
0142   0109 E1          DISL04:		POP		hl
0143   010A D3 02       			OUT		(SEGPORT),a
0144   010C 79          			LD		a,c
0145   010D D3 01       			OUT		(CATHPORT),a
0146   010F 06 40       			LD			b,CATHDLY
0147   0111 10 FE       DISL05:		DJNZ	DISL05
0148   0113 AF          			XOR		a
0149   0114 D3 01       			OUT		(CATHPORT),a
0150   0116 CB 19       			RR		c
0151   0118 ED 6F       			RLD
0152   011A DD 21 06 04 			LD		ix,HEX2SEG
0153   011E 16 00       			LD		d,$00
0154   0120 5F          			LD		e,a
0155   0121 DD 19       			ADD		ix,de
0156   0123 DD 7E 00    			LD		a,(ix)
0157   0126 E5          			PUSH	hl
0158   0127 21 C5 08    			LD		hl,MODE
0159   012A CB 46       			BIT		0,(hl)
0160   012C CA 31 01    			JP		z,DISL06
0161   012F F6 10       			OR		$10
0162   0131 E1          DISL06:		POP		hl
0163   0132 D3 02       			OUT		(SEGPORT),a
0164   0134 79          			LD		a,c
0165   0135 D3 01       			OUT		(CATHPORT),a
0166   0137 06 40       			LD		b,CATHDLY
0167   0139 10 FE       DISL07:		DJNZ	DISL07
0168   013B AF          			XOR		a
0169   013C D3 01       			OUT		(CATHPORT),a
0170   013E CB 19       			RR		c
0171   0140 2A C1 08    			LD		hl,(ADDRESS)
0172   0143 7E          			LD		a,(hl)
0173   0144 32 C3 08    			LD		(SCRATCH),a
0174   0147 AF          			XOR		a
0175   0148 21 C3 08    			LD		hl,SCRATCH
0176   014B ED 6F       			RLD
0177   014D DD 21 06 04 			LD		ix,HEX2SEG
0178   0151 16 00       			LD		d,$00
0179   0153 5F          			LD		e,a
0180   0154 DD 19       			ADD		ix,de
0181   0156 DD 7E 00    			LD		a,(ix)
0182   0159 E5          			PUSH	hl
0183   015A 21 C5 08    			LD		hl,MODE
0184   015D CB 46       			BIT		0,(hl)
0185   015F C2 64 01    			JP		nz,DISL08
0186   0162 F6 10       			OR		$10
0187   0164 E1          DISL08:		POP		hl
0188   0165 D3 02       			OUT		(SEGPORT),a
0189   0167 79          			LD		a,c
0190   0168 D3 01       			OUT		(CATHPORT),a
0191   016A 06 40       			LD		b,CATHDLY
0192   016C 10 FE       DISL09:		DJNZ	DISL09
0193   016E AF          			XOR		a
0194   016F D3 01       			OUT		(CATHPORT),a
0195   0171 CB 19       			RR		c
0196   0173 ED 6F       			RLD
0197   0175 DD 21 06 04 			LD		ix,HEX2SEG
0198   0179 16 00       			LD		d,$00
0199   017B 5F          			LD		e,a
0200   017C DD 19       			ADD		ix,de
0201   017E DD 7E 00    			LD		a,(ix)
0202   0181 E5          			PUSH	hl
0203   0182 21 C5 08    			LD		hl,MODE
0204   0185 CB 46       			BIT		0,(hl)
0205   0187 C2 8C 01    			JP		nz,DISL0A
0206   018A F6 10       			OR		$10
0207   018C E1          DISL0A:		POP		hl
0208   018D D3 02       			OUT		(SEGPORT),a
0209   018F 79          			LD		a,c
0210   0190 D3 01       			OUT		(CATHPORT),a
0211   0192 06 40       			LD		b,CATHDLY
0212   0194 10 FE       DISL0B:		DJNZ	DISL0B
0213   0196 C9          			RET
0214   0197             ;
0215   0197 E5          KEYBOARD:	PUSH	hl ; Key decoder routine.
0216   0198 F5          			PUSH	af
0217   0199 21 30 00    			LD		hl,$0030
0218   019C 22 C7 08    			LD		(BEEPLENGTH),hl
0219   019F 21 C9 08    			LD		hl,BEEPFREQ
0220   01A2 36 30       			LD		(hl),$30
0221   01A4 21 C6 08    			LD		hl,KEYDATA
0222   01A7 3E FF       			LD		a,$FF
0223   01A9 BE          			CP		(hl)
0224   01AA CA A1 03    			JP		z,KEYLXX
0225   01AD CD A9 03    			CALL	BEEP
0226   01B0 7E          			LD		a,(hl)
0227   01B1 E6 3F       			AND		$3f ; We only want the first 6 bits.
0228   01B3 EE 20       			XOR		$20 ; Flip bit 6 (Shift key) because it gives a 1 when not being pressed.
0229   01B5             ;
0230   01B5 FE 10       			CP		$10 ; + key.
0231   01B7 C2 CD 01    			JP		nz,KEYL00
0232   01BA 2A C1 08    			LD		hl,(ADDRESS)
0233   01BD 23          			INC		hl
0234   01BE 22 C1 08    			LD		(ADDRESS),hl
0235   01C1 21 C5 08    			LD		hl,MODE
0236   01C4 CB 86       			RES		0,(hl)
0237   01C6 CB 8E       			RES		1,(hl)
0238   01C8 CB 96       			RES		2,(hl)
0239   01CA C3 A1 03    			JP		KEYLXX
0240   01CD             ;
0241   01CD FE 11       KEYL00:		CP		$11 ; - key.
0242   01CF C2 E5 01    			JP		nz,KEYL01
0243   01D2 2A C1 08    			LD		hl,(ADDRESS)
0244   01D5 2B          			DEC		hl
0245   01D6 22 C1 08    			LD		(ADDRESS),hl
0246   01D9 21 C5 08    			LD		hl,MODE
0247   01DC CB 86       			RES		0,(hl)
0248   01DE CB 8E       			RES		1,(hl)
0249   01E0 CB 96       			RES		2,(hl)
0250   01E2 C3 A1 03    			JP		KEYLXX
0251   01E5             ;
0252   01E5 FE 12       KEYL01:		CP		$12 ; GO key.
0253   01E7 C2 F1 01    			JP		nz,KEYL02
0254   01EA 31 C0 08    			LD		sp,STACKTOP
0255   01ED 2A C1 08    			LD		hl,(ADDRESS)
0256   01F0 E9          			JP		(hl)
0257   01F1             ;
0258   01F1 FE 13       KEYL02:		CP		$13 ; AD key.
0259   01F3 C2 07 02    			JP		nz,KEYL03
0260   01F6 47          			LD		b,a
0261   01F7 3A C5 08    			LD		a,(MODE)
0262   01FA EE 01       			XOR		$01
0263   01FC CB 8F       			RES		1,a
0264   01FE CB 97       			RES		2,a
0265   0200 32 C5 08    			LD		(MODE),a
0266   0203 78          			LD		a,b
0267   0204 C3 A1 03    			JP		KEYLXX
0268   0207             ;
0269   0207 FE 20       KEYL03:		CP		$20 ; Shift-0 key.
0270   0209 CA A1 03    			JP		z,KEYLXX
0271   020C 00 00 00 00 			.DB		$00, $00, $00, $00, $00, $00, $00, $00, $00, $00
0271   0210 00 00 00 00 
0271   0214 00 00 
0272   0216 FE 21       KEYL04:		CP		$21 ; Shift-1 key.
0273   0218 CA A1 03    			JP		z,KEYLXX
0274   021B 00 00 00 00 			.DB		$00, $00, $00, $00, $00, $00, $00, $00, $00, $00
0274   021F 00 00 00 00 
0274   0223 00 00 
0275   0225 FE 22       KEYL05:		CP		$22 ; Shift-2 key.
0276   0227 CA A1 03    			JP		z,KEYLXX
0277   022A 00 00 00 00 			.DB		$00, $00, $00, $00, $00, $00, $00, $00, $00, $00
0277   022E 00 00 00 00 
0277   0232 00 00 
0278   0234 FE 23       KEYL06:		CP		$23 ; Shift-3 key.
0279   0236 CA A1 03    			JP		z,KEYLXX
0280   0239 00 00 00 00 			.DB		$00, $00, $00, $00, $00, $00, $00, $00, $00, $00
0280   023D 00 00 00 00 
0280   0241 00 00 
0281   0243 FE 24       KEYL07:		CP		$24 ; Shift-4 key.
0282   0245 CA A1 03    			JP		z,KEYLXX
0283   0248 00 00 00 00 			.DB		$00, $00, $00, $00, $00, $00, $00, $00, $00, $00
0283   024C 00 00 00 00 
0283   0250 00 00 
0284   0252 FE 25       KEYL08:		CP		$25 ; Shift-5 key.
0285   0254 CA A1 03    			JP		z,KEYLXX
0286   0257 00 00 00 00 			.DB		$00, $00, $00, $00, $00, $00, $00, $00, $00, $00
0286   025B 00 00 00 00 
0286   025F 00 00 
0287   0261 FE 26       KEYL09:		CP		$26 ; Shift-6 key.
0288   0263 CA A1 03    			JP		z,KEYLXX
0289   0266 00 00 00 00 			.DB		$00, $00, $00, $00, $00, $00, $00, $00, $00, $00
0289   026A 00 00 00 00 
0289   026E 00 00 
0290   0270 FE 27       KEYL0A:		CP		$27 ; Shift-7 key.
0291   0272 CA A1 03    			JP		z,KEYLXX
0292   0275 00 00 00 00 			.DB		$00, $00, $00, $00, $00, $00, $00, $00, $00, $00
0292   0279 00 00 00 00 
0292   027D 00 00 
0293   027F FE 28       KEYL0B:		CP		$28 ; Shift-8 key.
0294   0281 CA A1 03    			JP		z,KEYLXX
0295   0284 00 00 00 00 			.DB		$00, $00, $00, $00, $00, $00, $00, $00, $00, $00
0295   0288 00 00 00 00 
0295   028C 00 00 
0296   028E FE 29       KEYL0C:		CP		$29 ; Shift-9 key.
0297   0290 CA A1 03    			JP		z,KEYLXX
0298   0293 00 00 00 00 			.DB		$00, $00, $00, $00, $00, $00, $00, $00, $00, $00
0298   0297 00 00 00 00 
0298   029B 00 00 
0299   029D FE 2A       KEYL0D:		CP		$2A ; Shift-A key.
0300   029F CA A1 03    			JP		z,KEYLXX
0301   02A2 00 00 00 00 			.DB		$00, $00, $00, $00, $00, $00, $00, $00, $00, $00
0301   02A6 00 00 00 00 
0301   02AA 00 00 
0302   02AC FE 2B       KEYL0E:		CP		$2B ; Shift-B key.
0303   02AE CA A1 03    			JP		z,KEYLXX
0304   02B1 00 00 00 00 			.DB		$00, $00, $00, $00, $00, $00, $00, $00, $00, $00
0304   02B5 00 00 00 00 
0304   02B9 00 00 
0305   02BB FE 2C       KEYL0F:		CP		$2C ; Shift-C key.
0306   02BD CA A1 03    			JP		z,KEYLXX
0307   02C0 00 00 00 00 			.DB		$00, $00, $00, $00, $00, $00, $00, $00, $00, $00
0307   02C4 00 00 00 00 
0307   02C8 00 00 
0308   02CA FE 2D       KEYL10:		CP		$2D ; Shift-D key.
0309   02CC CA A1 03    			JP		z,KEYLXX
0310   02CF 00 00 00 00 			.DB		$00, $00, $00, $00, $00, $00, $00, $00, $00, $00
0310   02D3 00 00 00 00 
0310   02D7 00 00 
0311   02D9 FE 2E       KEYL11:		CP		$2E ; Shift-E key.
0312   02DB CA A1 03    			JP		z,KEYLXX
0313   02DE 00 00 00 00 			.DB		$00, $00, $00, $00, $00, $00, $00, $00, $00, $00
0313   02E2 00 00 00 00 
0313   02E6 00 00 
0314   02E8 FE 2F       KEYL12:		CP		$2F ; Shift-F key.
0315   02EA CA A1 03    			JP		z,KEYLXX
0316   02ED             ;
0317   02ED FE 30       KEYL13:		CP		$30 ; Shift-+ key.
0318   02EF C2 13 03    			JP		nz,KEYL14
0319   02F2 21 FF FF    			LD		hl,RAMTOP
0320   02F5 ED 5B C1 08 			LD		de,(ADDRESS)
0321   02F9 ED 52       			SBC		hl,de
0322   02FB 44          			LD		b,h
0323   02FC 4D          			LD		c,l
0324   02FD 21 FF FF    			LD		hl,RAMTOP
0325   0300 54          			LD		d,h
0326   0301 5D          			LD		e,l
0327   0302 2B          			DEC		hl
0328   0303 ED B8       			LDDR
0329   0305 62          			LD		h,d
0330   0306 6B          			LD		l,e
0331   0307 36 00       			LD		(hl),$00
0332   0309 21 C5 08    			LD		hl,MODE
0333   030C CB 8E       			RES		1,(hl)
0334   030E CB 96       			RES		2,(hl)
0335   0310 C3 A1 03    			JP		KEYLXX
0336   0313             ;
0337   0313 FE 31       KEYL14:		CP		$31 ; Shift-- key.
0338   0315 C2 39 03    			JP		nz,KEYL15
0339   0318 21 FF FF    			LD		hl,RAMTOP
0340   031B ED 5B C1 08 			LD		de,(ADDRESS)
0341   031F ED 52       			SBC		hl,de
0342   0321 44          			LD		b,h
0343   0322 4D          			LD		c,l
0344   0323 2A C1 08    			LD		hl,(ADDRESS)
0345   0326 54          			LD		d,h
0346   0327 5D          			LD		e,l
0347   0328 23          			INC		hl
0348   0329 ED B0       			LDIR
0349   032B 62          			LD		h,d
0350   032C 6B          			LD		l,e
0351   032D 36 00       			LD		(hl),$00
0352   032F 21 C5 08    			LD		hl,MODE
0353   0332 CB 8E       			RES		1,(hl)
0354   0334 CB 96       			RES		2,(hl)
0355   0336 C3 A1 03    			JP		KEYLXX
0356   0339             ;
0357   0339 FE 32       KEYL15:		CP		$32 ; Shift-GO key.
0358   033B CA A1 03    			JP		z,KEYLXX
0359   033E FE 33       KEYL16:		CP		$33 ; Shift-AD key.
0360   0340 CA A1 03    			JP		z,KEYLXX
0361   0343             ;
0362   0343 21 C5 08    KEYL17:		LD		hl,MODE ; Non-shifted digit keys entry.
0363   0346 CB 46       			BIT		0,(hl) ; 0 = Data Mode, 1 = Address Mode.
0364   0348 C2 7C 03    			JP		nz,KEYL19
0365   034B CB 4E       			BIT		1,(hl)
0366   034D CA 68 03    			JP		z,KEYL17B ; Jump on 1st time through a data edit.
0367   0350 CB 56       			BIT		2,(hl)
0368   0352 CA 66 03    			JP		z,KEYL17A ; Jump on 2nd time through a data edit.
0369   0355 CB 8E       			RES		1,(hl) ; Do this the 3rd time round a data edit.
0370   0357 CB 96       			RES		2,(hl)
0371   0359 2A C1 08    			LD		hl,(ADDRESS)
0372   035C 23          			INC		hl
0373   035D 22 C1 08    			LD		(ADDRESS),hl
0374   0360 21 C5 08    			LD		hl,MODE
0375   0363 C3 68 03    			JP		KEYL17B
0376   0366 CB D6       KEYL17A:	SET		2,(hl)
0377   0368 CB 4E       KEYL17B:	BIT		1,(hl) ; 0 = first nibble, 1 = second nibble.
0378   036A C2 74 03    			JP		nz,KEYL18
0379   036D CB CE       			SET		1,(hl)
0380   036F 2A C1 08    			LD		hl,(ADDRESS)
0381   0372 36 00       			LD		(hl),$00
0382   0374             ;
0383   0374 2A C1 08    KEYL18:		LD		hl,(ADDRESS)
0384   0377 ED 6F       			RLD
0385   0379 C3 A1 03    KEYL18A:	JP		KEYLXX
0386   037C             ;
0387   037C CB 4E       KEYL19:		BIT		1,(hl) ; 0 = first nibble, 1 = subsequent nibbles.
0388   037E C2 89 03    			JP		nz,KEYL1A
0389   0381 CB CE       			SET		1,(hl)
0390   0383 21 00 00    			LD		hl,$0000
0391   0386 22 C1 08    			LD		(ADDRESS),hl
0392   0389             ;
0393   0389 21 C1 08    KEYL1A:		LD		hl,ADDRESS
0394   038C ED 6F       			RLD
0395   038E 2A C1 08    			LD		hl,(ADDRESS)
0396   0391 CB 24       			SLA		h
0397   0393 CB 24       			SLA		h
0398   0395 CB 24       			SLA		h
0399   0397 CB 24       			SLA		h
0400   0399 47          			LD		b,a
0401   039A AF          			XOR		a
0402   039B B4          			OR		h
0403   039C B0          			OR		b
0404   039D 67          			LD		h,a
0405   039E 22 C1 08    			LD		(ADDRESS),hl
0406   03A1             ;
0407   03A1 21 C6 08    KEYLXX:		LD		hl,KEYDATA ; Done with the key decoder.
0408   03A4 36 FF       			LD		(hl),$FF
0409   03A6 F1          			POP		af
0410   03A7 E1          			POP		hl
0411   03A8 C9          			RET
0412   03A9             ;
0413   03A9 E5          BEEP:		PUSH	hl
0414   03AA F5          			PUSH	af
0415   03AB 21 C9 08    			LD		hl,BEEPFREQ
0416   03AE 4E          			LD		c,(hl)
0417   03AF 2A C7 08    			LD		hl,(BEEPLENGTH)
0418   03B2 AF          			XOR		a
0419   03B3 57          			LD		d,a
0420   03B4 41          BEEPL01:	LD		b,c
0421   03B5 7A          			LD		a,d
0422   03B6 D3 01       			OUT		(CATHPORT),a
0423   03B8 10 FE       BEEPL02:	DJNZ	BEEPL02
0424   03BA EE 80       			XOR		$80
0425   03BC 2B          			DEC		hl
0426   03BD 57          			LD		d,a
0427   03BE 7C          			LD		a,h
0428   03BF B5          			OR		l
0429   03C0 C2 B4 03    			JP		nz,BEEPL01
0430   03C3 F1          			POP		af
0431   03C4 E1          			POP		hl
0432   03C5 C9          			RET
0433   03C6             ;
0434   03C6 E5          STARTBEEP:	PUSH	hl
0435   03C7 F5          			PUSH	af
0436   03C8 21 7F 00    			LD		hl,$007F
0437   03CB 22 C7 08    			LD		(BEEPLENGTH),hl
0438   03CE 21 C9 08    			LD		hl,BEEPFREQ
0439   03D1 36 35       			LD		(hl),$35
0440   03D3 CD A9 03    			CALL	BEEP
0441   03D6 36 30       			LD		(hl),$30
0442   03D8 CD A9 03    			CALL	BEEP
0443   03DB 36 25       			LD		(hl),$25
0444   03DD CD A9 03    			CALL	BEEP
0445   03E0 36 20       			LD		(hl),$20
0446   03E2 CD A9 03    			CALL	BEEP
0447   03E5 F1          			POP		af
0448   03E6 E1          			POP		hl
0449   03E7 C9          			RET
0450   03E8             ;			
0451   03E8 31 C0 08    SETUP:		LD		sp,STACKTOP ; Post reset/power up setup.
0452   03EB 21 00 09    			LD		hl,RAMBASE
0453   03EE 22 C1 08    			LD		(ADDRESS),hl
0454   03F1 AF          			XOR		a
0455   03F2 32 C5 08    			LD		(MODE),a
0456   03F5 3E FF       			LD		a,$FF
0457   03F7 32 C6 08    			LD		(KEYDATA),a
0458   03FA CD C6 03    			CALL	STARTBEEP
0459   03FD             ;
0460   03FD CD 80 00    MAIN:		CALL	DISPLAY
0461   0400 CD 97 01    			CALL	KEYBOARD
0462   0403 C3 FD 03    			JP		MAIN
0463   0406             ;
0464   0406 EB 28 CD AD HEX2SEG:	.DB		$EB,$28,$CD,$AD,$2E,$A7,$E7,$29 ; HEX Byte to LED Segment conversion.
0464   040A 2E A7 E7 29 
0465   040E EF 2F 6F E6 			.DB		$EF,$2F,$6F,$E6,$C3,$EC,$C7,$47
0465   0412 C3 EC C7 47 
0466   0416             ;
0467   0416             ; BEGIN MODULES.
0468   0416             ; START MOD-xx - xxxxx.
0469   0416             ; END MOD-xx
0470   0416             ;
0471   0416             ; END MODULES.
0472   0416             ;
0473   0416             			.END
tasm: Number of errors = 0
